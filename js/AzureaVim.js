AzureaUtil={};AzureaUtil.mixin={};AzureaUtil.event={};AzureaUtil.time={};
(function(){function a(f,d,h){var i;if(typeof h==="undefined")h=true;for(i in d)if(h||typeof f[i]==="undefined")f[i]=d[i]}function e(f,d){for(var h=eval(f),i=-1;h[++i];)h[i]===d&&h.splice(i,1);h.push(d)}function g(){var f=(new Date).getTime(),d;for(d in b)if(b[d][0]<=f){b[d][1]();delete b[d]}for(d in c)if(c[d][0]<=f){c[d][0]+=c[d][2];c[d][1]()}}AzureaUtil.mixin=a;a(AzureaUtil.event,{PreProcessTimelineStatuses:[],PreProcessTimelineStatus:[],PreFilterProcessTimelineStatus:[],PostFilterProcessTimelineStatus:[],
PostProcessTimelineStatus:[],PostProcessTimelineStatuses:[],PreSendUpdateStatus:[],PostSendUpdateStatus:[],ReceiveFavorite:[],addEventListener:e,removeEventListener:function(f,d){for(var h=eval(f),i=-1;h[++i];)if(h[i]===d){h.splice(i,1);break}}});var b={},c={};e("PreProcessTimelineStatus",g);e("PostSendUpdateStatus",g);e("ReceiveFavorite",g);a(AzureaUtil.time,{setTimeout:function(f,d){var h=Math.floor(Math.random()*(new Date).getTime()).toString(36);b[h]=[(new Date).getTime()+d,f];return h},clearTimeout:function(f){delete b[f]},
setInterval:function(f,d){var h=Math.floor(Math.random()*(new Date).getTime()).toString(36);timeinterval_list[h]=[(new Date).getTime()+d,f,d];return h},clearInterval:function(f){delete timeinterval_list[f]}})})();function PreProcessTimelineStatus(a){for(var e=AzureaUtil.event.PreProcessTimelineStatus,g=-1;e[++g];)e[g](a)}function PreFilterProcessTimelineStatus(a){for(var e=AzureaUtil.event.PreFilterProcessTimelineStatus,g=-1,b,c=false;e[++g];){b=e[g](a);c=c||b}return c}
function PreSendUpdateStatus(a){for(var e=AzureaUtil.event.PreSendUpdateStatus,g=-1,b,c=false;e[++g];){b=e[g](a);c=c||b}return c}function PostSendUpdateStatus(){for(var a=AzureaUtil.event.PostSendUpdateStatus,e=-1;a[++e];)a[e]()}function ReceiveFavorite(a,e,g){for(var b=AzureaUtil.event.ReceiveFavorite,c=-1;b[++c];)b[c](a,e,g)}
(function(){function a(g){TextArea.text=":";TextArea.in_reply_to_status_id=g;TextArea.show();TextArea.setFocus();TextArea.setCursor(1)}var e={};System.addKeyBindingHandler(186,0,a);System.addContextMenuHandler(":vim",0,a);AzureaUtil.event.addEventListener("PreSendUpdateStatus",function(g){var b,c=false;try{if(/^:/.test(g.text)){c=true;b=new AzureaVim(g);TextArea.text="";TextArea.in_reply_to_status_id=0;b.run()}}catch(f){System.alert(f.name+":\n"+f.message);c=true}return c});AzureaVim=function(g){var b=
this.command_text=g.text.slice(1),c=[],f,d=/[^\s"]+|\s+|"[^\\"]*(?:\\.[^\\"]*)*"/g;for(b=b.replace(/^\s+|\s+$/g,"");f=d.exec(b);)/^\s/.test(f[0])||c.push(f[0].replace(/^"|"$/g,""));this.command=c;this.status_id=g.in_reply_to_status_id;this.screen_name=TwitterService.status.get(this.status_id).user.screen_name;this.status_text=TwitterService.status.get(this.status_id).text;this.status_urls=[];this.status_hashes=[];this.status_users=[];TwitterService.status.getUrls(this.status_id,this.status_urls);
TwitterService.status.getHashes(this.status_id,this.status_hashes);TwitterService.status.getUsers(this.status_id,this.status_users)};AzureaVim.commands_list=e;AzureaVim.prototype.run=function(){var g=e[this.command[0]];if(/ /.test(g)){this.command.shift();this.command=g.split(" ").concat(this.command)}else this.command[0]=g;this[this.command[0]]()}})();AzureaUtil.mixin(AzureaVim.commands_list,{unshorten:"unshorten"});
(function(){function a(b){for(var c=AzureaVim.prototype.unshorten.services,f=-1,d=false;c[++f];)if(b.indexOf(c[f])!==-1){d=true;break}return d}function e(b,c){var f=AzureaVim.prototype.unshorten.cashe,d,h=b;if(a(b))if(f[b])h=f[b];else if(c)try{Http.sendRequestAsync("http://untiny.me/api/1.0/extract/?url="+b+"&format=text",false,function(j){AzureaVim.prototype.unshorten.cashe[b]=/^error/.test(j.body)?b:j.body})}catch(i){}else try{d=Http.sendRequest("http://untiny.me/api/1.0/extract/?url="+b+"&format=text",
false);h=/^error/.test(d.body)?b:d.body;f[b]=h}catch(k){}return h}AzureaVim.prototype.unshorten=function(){var b=this.status_urls[this.command[1]||0],c=e(b);System.inputBox(b,c,false);return c};AzureaVim.prototype.unshorten.services=[];AzureaVim.prototype.unshorten.cashe={"http://c4se.tk/":"http://c4se.sakura.ne.jp/"};try{Http.sendRequestAsync("http://untiny.me/api/1.0/services/?format=text",true,function(b){AzureaVim.prototype.unshorten.services=b.body.split(", ")})}catch(g){}AzureaVim.prototype.unshorten.unshorten=
e;AzureaUtil.event.addEventListener("PreProcessTimelineStatus",function(b){b.text=b.text.replace(/https?:\/\/[0-9A-Za-z._\-^~\/&%?]+/g,function(c){return e(c,true)})})})();AzureaUtil.mixin(AzureaVim.commands_list,{open:"open",o:"open","\u304a":"open",url:"open url"});
AzureaVim.prototype.open=function(){var a;switch({status:"status",favstar:"favstar",fav:"favstar",f:"favstar",favotter:"favotter",favlook:"favlook",twistar:"twistar",favolog:"favolog",twilog:"twilog",user:"user",url:"url"}[this.command[1]]){case "status":a="https://twitter.com/"+this.screen_name+"/status/"+this.status_id;break;case "favstar":a="http://favstar.fm/t/"+this.status_id;break;case "favotter":a="http://favotter.net/status.php?id="+this.status_id;break;case "favlook":a="http://favlook.osa-p.net/status.html?status_id="+
this.status_id;break;case "twistar":a="http://twistar.cc/"+this.screen_name+"/status/"+this.status_id;break;case "favolog":a="http://favolog.org/"+(this.command[2]||this.screen_name);break;case "twilog":a="http://twilog.org/"+(this.command[2]||this.screen_name);break;case "user":a="http://twitter.com/"+(this.command[2]||this.screen_name);break;case "url":this.command[2]||(this.command[2]=0);a=this.unshorten.unshorten(this.status_urls[this.command[2]],true);break;default:a=this.status_urls[0]?this.unshorten.unshorten(this.status_urls[0],
true):"https://twitter.com/"+this.screen_name+"/status/"+this.status_id}System.openUrl(a)};AzureaUtil.mixin(AzureaVim.commands_list,{reply:"reply",r:"reply","@":"reply",quotetweet:"reply quote",qt:"reply quote","\uff51\uff54":"reply quote",mrt:"reply mrt","\uff4d\uff52\uff54":"reply mrt"});
(function(){function a(e,g){var b,c=e.replace(/#{([^}]+?)}/g,function(f,d){with(g)return eval(d)});c=c.split("#{}");if(c.length===1){b=0;c=c[0]}else{b=c[0].length;c=c.join("")}c.cursor=b;return{text:c,cursor:b}}AzureaVim.prototype.reply=function(){var e;switch({template:"template",all:"all",quote:"quote",qt:"quote",mrt:"mrt",masirosiki:"mrt"}[this.command[1]]){case "template":e=a(this.command[2],this);Http.sendRequestAsync("http://google.com/",false,new Function("TextArea.text = '"+e.text.replace("'",
"\\'")+"';TextArea.in_reply_to_status_id = '"+(this.command[3]==="true"?this.status_id:0)+"';TextArea.show();TextArea.setFocus();TextArea.setCursor("+e.cursor+");"));break;case "all":this.command=["reply","template","@#{screen_name + (status_users.length ? ' @' +status_users.join(' @') : '')} #{}","true"];this.reply();break;case "quote":this.command=["reply","template","@#{screen_name} #{} RT: #{status_text}","true"];this.reply();break;case "mrt":this.command=this.command[2]==="f"||this.command[2]===
"fav"||this.command[2]==="favstar"?["reply","template","#{} MRT: #{'http://favstar.fm/t/' + status_id}","false"]:["reply","template","#{} MRT: #{'http://twitter.com/' + screen_name + '/status/' + status_id}","false"];this.reply();break;default:this.command=["reply","template","@#{screen_name} #{}#{status_hashes.length ? ' ' + status_hashes.join(' ') : ''}","true"];this.reply()}}})();AzureaUtil.mixin(AzureaVim.commands_list,{retweet:"retweet",rt:"retweet"});AzureaVim.prototype.retweet=function(){TwitterService.retweet.create(this.status_id)};
AzureaUtil.mixin(AzureaVim.commands_list,{settings:"settings",setting:"settings",set:"settings",get:"settings"});AzureaVim.prototype.settings=function(){var a;a=this.command.slice(1).join("");a=a.split("::");a=[a[0]].concat(a[1].split("="));if(/^get/.test(this.command[0]))a.length=2;if(a[2]){System.settings.setValue(a[0],a[1],a[2]);System.showNotice("Setting done: "+a[0]+"::"+a[1]+"="+a[2])}else System.showNotice("Getting done: "+a[0]+"::"+a[1]+"="+System.settings.getValue(a[0],a[1]))};
AzureaUtil.mixin(AzureaVim.commands_list,{shindan:"shindanmaker"});AzureaVim.prototype.shindanmaker=function(){for(var a,e=-1;a=this.unshorten.unshorten(this.status_urls[++e],true);)if(a.match("^http://shindanmaker.com/[0-9]+"))break;if(a)Http.postRequestAsync(a,"u="+encodeURI(this.command[1]||TwitterService.currentUser().screen_name),false,function(g){g.body.match("<textarea.*?>(.*?)</textarea>");TextArea.text=RegExp.$1;TextArea.in_reply_to_status_id=0;TextArea.show();TextArea.setFocus()})};
AzureaUtil.mixin(AzureaVim.commands_list,{translate:"translate",ja:"translate ja"});
AzureaVim.prototype.translate=function(){this.command[1]||(this.command[1]="ja");Http.sendRequestAsync("https://www.googleapis.com/language/translate/v2?key=AIzaSyCva1yUIFIBRqXOZDJ0nrbGbm0bz3FIksc&q="+encodeURI(this.status_text)+"&target="+this.command[1],false,function(a){if(a.statusCode!==200)throw Error("Google Translate API Error. statusCode is "+a.statusCode+".");System.showMessage(a.body.match(/"translatedText"\s*:\s*"(.*)"/)[1],a.body.match(/"detectedSourceLanguage"\s*:\s*"(.*)"/)[1]+"-> ",
0)})};AzureaUtil.mixin(AzureaVim.commands_list,{view:"view",v:"view",home:"view home",user:"view user"});
AzureaVim.prototype.view=function(){var a=System.apiLevel>=11?System.views:System;switch({home:"home",timeline:"home",h:"home",mention:"mention",reply:"mention",r:"mention",m:"mention","@":"mention",message:"message",dm:"message",d:"message",user:"user",u:"user",favorite:"favorite",fav:"favorite",f:"favorite",following:"following",follow:"following",followers:"followers",follower:"followers",followed:"followers"}[this.command[1]]){case "home":a.openTimeline();break;case "mention":a.openMention();
break;case "message":a.openMessage();break;case "user":a.openUserTimeline(this.command[2]||this.screen_name,false);break;case "search":a.openSearch(this.command[2],false);break;case "favorite":a.openFavorite();break;case "match":a.openMatch(this.command[2],false);break;case "following":a.openFollwoing();break;case "followers":a.openFollowers()}};
