// ==AzureaScript==
// @name AzureaVim
// @author http://c4se.sakura.ne.jp/profile.html
// @scriptUrl https://github.com/ne-sachirou/AzureaVim/raw/master/js/
// @date 2011-04-04
// @license MIT License
// ==/AzureaScript==
AzureaUtil={mixin:{},ApiProxy:{},db:{},event:{},time:{},template:{},yank:{},notify:{}};
(function(){function d(a,c,h){var j;if(h==null)h=true;for(j in c)if(h||typeof a[j]==="undefined")a[j]=c[j]}function e(a){if(!(this instanceof e))return new e(a);a=a||"";this.uri=t+a;return this}function b(a,c){System.settings.setValue("user.AzureaVim",a,encodeURIComponent(c));u[a]=c}function f(a){u[a]||(u[a]=decodeURIComponent(System.settings.getValue("user.AzureaVim",a)));return u[a]}function g(a){System.settings.setValue("user.AzureaVim",a,"");delete u[a]}function l(a,c){for(var h=q[a],j=-1;h[++j];)h[j]===
c&&h.splice(j,1);h.push(c)}function i(){var a=(new Date).getTime(),c;for(c in w)if(w[c][0]<=a){w[c][1]();delete w[c]}for(c in A)if(A[c][0]<=a){A[c][0]=a+A[c][2];A[c][1]()}for(c in timeevent_list)if(timeevent_list[c][0]<=a){timeevent_list[c][1]();g("TimeEvent"+timeevent_list[c][2]);delete timeevent_list[c]}}function v(a){System.isActive?System.showNotice(a):System.showMessage(a,a,1048576)}function k(a,c,h,j){a={title:a,text:c,sticky:j?"on":null};a[/^https?:\/\/./.test(h)?"icon_uri":"twitter_screen_name"]=
h;G.submit(null,a,function(x){try{var n=JSON.parse(x.body);n.error&&v(n.request.text)}catch(m){v(m.message+x.body)}})}JSON={};(function(){function a(p){return p<10?"0"+p:p}function c(p){x.lastIndex=0;return x.test(p)?'"'+p.replace(x,function(C){var s=r[C];return typeof s==="string"?s:"\\u"+("0000"+C.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+p+'"'}function h(p,C){var s,z,D,F,E=n,B,o=C[p];if(o&&typeof o==="object"&&typeof o.toJSON==="function")o=o.toJSON(p);if(typeof y==="function")o=y.call(C,
p,o);switch(typeof o){case "string":return c(o);case "number":return isFinite(o)?String(o):"null";case "boolean":case "null":return String(o);case "object":if(!o)return"null";n+=m;B=[];if(Object.prototype.toString.apply(o)==="[object Array]"){F=o.length;for(s=0;s<F;s+=1)B[s]=h(s,o)||"null";D=B.length===0?"[]":n?"[\n"+n+B.join(",\n"+n)+"\n"+E+"]":"["+B.join(",")+"]";n=E;return D}if(y&&typeof y==="object"){F=y.length;for(s=0;s<F;s+=1)if(typeof y[s]==="string"){z=y[s];if(D=h(z,o))B.push(c(z)+(n?": ":
":")+D)}}else for(z in o)if(Object.prototype.hasOwnProperty.call(o,z))if(D=h(z,o))B.push(c(z)+(n?": ":":")+D);D=B.length===0?"{}":n?"{\n"+n+B.join(",\n"+n)+"\n"+E+"}":"{"+B.join(",")+"}";n=E;return D}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=
Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var j=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,x=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,n,m,r={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},y;if(typeof JSON.stringify!=="function")JSON.stringify=function(p,C,s){var z;m=n="";if(typeof s===
"number")for(z=0;z<s;z+=1)m+=" ";else if(typeof s==="string")m=s;if((y=C)&&typeof C!=="function"&&(typeof C!=="object"||typeof C.length!=="number"))throw Error("JSON.stringify");return h("",{"":p})};if(typeof JSON.parse!=="function")JSON.parse=function(p,C){function s(D,F){var E,B,o=D[F];if(o&&typeof o==="object")for(E in o)if(Object.prototype.hasOwnProperty.call(o,E)){B=s(o,E);if(B!==undefined)o[E]=B;else delete o[E]}return C.call(D,F,o)}var z;p=String(p);j.lastIndex=0;if(j.test(p))p=p.replace(j,
function(D){return"\\u"+("0000"+D.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(p.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){z=eval("("+p+")");return typeof C==="function"?s({"":z},""):z}throw new SyntaxError("JSON.parse");}})();AzureaUtil.mixin=d;var t="http://localhost:80/";e.prototype={submit:function(a,c,h){var j,x=this.uri,n=[],m;for(m in c)c[m]&&n.push(m+
"="+c[m]);n=encodeURI(n.join("&"));a=(a=a||"")?/\/$/.test(x)&&a.charAt(0)==="/"?x.substring(1)+a:!/\/$/.test(x)&&a.charAt(0)!=="/"?x+"/"+a:x+a:x;if(h&&c)Http.postRequestAsync(a,n,false,h);else if(h)Http.sendRequestAsync(a,false,h);else j=c?Http.postRequest(a,n,false):Http.sendRequest(a,false);return j}};AzureaUtil.ApiProxy=e;var u={};d(AzureaUtil.db,{get:f,set:b,del:g,keys:function(){var a,c=[];for(a in u)match.test(a)&&c.push(a);return c}});var q={PreProcessTimelineStatuses:[],PreProcessTimelineStatus:[],
PreFilterProcessTimelineStatus:[],PostFilterProcessTimelineStatus:[],PostProcessTimelineStatus:[],PostProcessTimelineStatuses:[],PreSendUpdateStatus:[],PostSendUpdateStatus:[],ReceiveFavorite:[]};d(AzureaUtil.event,{PreProcessTimelineStatuses:q.PreProcessTimelineStatuses,PreProcessTimelineStatus:q.PreProcessTimelineStatus,PreFilterProcessTimelineStatus:q.PreFilterProcessTimelineStatus,PostFilterProcessTimelineStatus:q.PostFilterProcessTimelineStatus,PostProcessTimelineStatus:q.PostProcessTimelineStatus,
PostProcessTimelineStatuses:q.PostProcessTimelineStatuses,PreSendUpdateStatus:q.PreSendUpdateStatus,PostSendUpdateStatus:q.PostSendUpdateStatus,ReceiveFavorite:q.ReceiveFavorite,addEventListener:l,removeEventListener:function(a,c){for(var h=q[a],j=-1;h[++j];)if(h[j]===c){h.splice(j,1);break}}});var w={},A={};timeevent_list=function(){for(var a={},c,h=-1;c=f("TimeEvent"+ ++h);)a[c.substring(0,c.indexOf(":"))]=[c.substring(c.indexOf(":")+1,c.indexOf("|"))-0,eval("(function(){return "+c.substring(c.indexOf("|")+
1)+"})()"),h];return a}();l("PreProcessTimelineStatus",i);l("PostSendUpdateStatus",i);l("ReceiveFavorite",i);d(AzureaUtil.time,{setTimeout:function(a,c){var h=Math.floor(Math.random()*(new Date).getTime()).toString(36);w[h]=[(new Date).getTime()+c,a];return h},clearTimeout:function(a){delete w[a]},setInterval:function(a,c){var h=Math.floor(Math.random()*(new Date).getTime()).toString(36);timeinterval_list[h]=[(new Date).getTime()+c,a,c];return h},clearInterval:function(a){delete timeinterval_list[a]},
setTimeevent:function(a,c){for(var h=Math.floor(Math.random()*(new Date).getTime()).toString(36),j=-1;f("TimeEvent"+ ++j););b("TimeEvent"+j,h+":"+c+"|"+a);timeevent_list[h]=[c,eval("(function(){return "+a+"})()"),j];return h},clearTimeevent:function(a){g("TimeEvent"+timeevent_list[a][2]);delete timeevent_list[a]}});d(AzureaUtil.template,{expand:function(a,c){function h(m){var r,y,p;if(typeof m==="string"||m instanceof String)r='"'+m.replace('"','\\"')+'"';else if(typeof m==="number"||m instanceof
Number)r=m.toString(10);else if(m===true||m===false)r=m;else if(m===null)r="null";else if(typeof m==="undefined")r="void(0)";else if(m instanceof Array){r="[";y=0;for(p=m.length;y<p;++y)r+=h(m[y])+",";r=r.replace(/,$/,"")+"]"}else{r="{";for(y in m)if(m.hasOwnProperty(y))r+='"'+y+'":'+h(m[y])+",";r=r.replace(/,$/,"")+"}"}return r}var j,x=function(){var m,r="";for(m in c)if(c.hasOwnProperty(m))r+="var "+m+"="+h(c[m])+";";return r}(),n=a.replace(/#{([^}]+?)}/g,function(m,r){return eval("(function(){"+
x+"return ("+r+")})()")});n=n.split("#{}");if(n.length===1){j=0;n=n[0]}else{j=n[0].length;n=n.join("")}return{text:n,cursor:j}}});d(AzureaUtil.yank,{get:function(a){if(a){a=a.charAt(0);if(/[0-9A-Za-z]/.test(a))a=""}else a="";return f("Yank"+a)},set:function(a,c){if(a){a=a.charAt(0);if(/[0-9A-Za-z]/.test(a))a=""}else a="";b("Yank"+a,c);return c}});var G=new e("gntp");f("NotifyUseGrowl")||b("NotifyUseGrowl","0");AzureaUtil.notify=function(a,c,h,j){var x=System.systemInfo<=2&&f("NotifyUseGrowl");try{x?
k(c,a,h,j):v(a)}catch(n){v(a)}}})();function PreProcessTimelineStatus(d){for(var e=AzureaUtil.event.PreProcessTimelineStatus,b=-1;e[++b];)e[b](d)}function PreFilterProcessTimelineStatus(d){for(var e=AzureaUtil.event.PreFilterProcessTimelineStatus,b=-1,f,g=false;e[++b];){f=e[b](d);g=g||f}return g}function PreSendUpdateStatus(d){for(var e=AzureaUtil.event.PreSendUpdateStatus,b=-1,f,g=false;e[++b];){f=e[b](d);g=g||f}return g}
function PostSendUpdateStatus(){for(var d=AzureaUtil.event.PostSendUpdateStatus,e=-1;d[++e];)d[e]()}function ReceiveFavorite(d,e,b){for(var f=AzureaUtil.event.ReceiveFavorite,g=-1;f[++g];)f[g](d,e,b)}AzureaVim={};
(function(){function d(g){var l=TwitterService.status,i=g.in_reply_to_status_id,v=l.get(i);this.item=f;g=this.command_text=g.text.slice(1);var k=[],t,u=/[^\s"]+|\s+|"[^\\"]*(?:\\.[^\\"]*)*"/g;for(g=g.replace(/^\s+|\s+$/g,"");t=u.exec(g);)/^\s/.test(t[0])||k.push(t[0].replace(/^"|"$/g,""));this.command=k;this.status_id=i;this.screen_name=v.user.screen_name;this.status_text=v.text;this.status_urls=[];this.status_hashes=[];this.status_users=[];l.getUrls(i,this.status_urls);l.getHashes(i,this.status_hashes);
l.getUsers(i,this.status_users)}var e={},b,f;System.addKeyBindingHandler(186,0,function(g){selected_view=System.views.currentView;b=selected_view.selectedItemId;f=selected_view.getItem(b);AzureaUtil.yank.set(null,TextArea.text);TextArea.text=":";TextArea.in_reply_to_status_id=g;TextArea.show();TextArea.setFocus();TextArea.cursor=1});System.addContextMenuHandler(":vim",0,function(){var g=System.inputBox("command","",true);AzureaUtil.yank.set(null,g);(new d({text:":"+g,in_reply_to_status_id:System.views.currentView.selectedStatusId})).run()});
AzureaUtil.event.addEventListener("PreSendUpdateStatus",function(g){var l,i=false;try{if(g.text===":"){i=true;AzureaUtil.time.setTimeout(function(){TextArea.text=AzureaUtil.yank.get(null);TextArea.show()},0)}else if(/^(?::|\uff1a)/.test(g.text)){i=true;AzureaUtil.yank.set(null,g.text);l=new d(g);TextArea.text="";TextArea.in_reply_to_status_id=0;l.run()}else AzureaUtil.yank.set(null,g.text)}catch(v){System.alert(v.name+":\n"+v.message);i=true}return i});AzureaVim=d;AzureaVim.commands_list=e;AzureaVim.prototype=
{run:function(){var g=this.command,l=e[this.command[0]];if(l){if(l.indexOf(" ")!==-1){g.shift();g=this.command=l.split(" ").concat(g);l=g[0]}this[l]()}else System.showNotice(":"+g[0]+" command is undefined.")}}})();AzureaUtil.mixin(AzureaVim.commands_list,{eval:"_evaluate"});AzureaVim.prototype._evaluate=function(){this.command[1]=this.command.slice(1).join(" ");System.inputBox(this.command[1],eval(this.command[1]),false)};AzureaUtil.mixin(AzureaVim.commands_list,{unshorten:"unshorten","\u3046\u3093\u3057\u3087\uff52\u3066\uff4e":"unshorten"});
(function(){function d(k){g=k.body.split(", ");g.push("htn.ly")}function e(k){for(var t=g,u=-1,q=false;t[++u];)if(k.indexOf(t[u])!==-1){q=true;break}return q}function b(k,t){function u(j){w=(j=j.header.match(/Location: ([^\n]+)\n/))?j[1]:k;j=j?j[1]:k;return w[k]=j}function q(j){j=/^error/.test(j.body)?k:j.body;return w[k]=j}var w=l,A=k;if(w[k])A=w[k];else if(k.indexOf("htn.to")!==-1)if(t)try{Http.sendRequestAsync(k,false,u)}catch(G){}else try{A=callback_htly(Http.sendRequest(k,false))}catch(a){}else if(e(k))if(t)try{Http.sendRequestAsync("http://untiny.me/api/1.0/extract/?url="+
k+"&format=text",false,q)}catch(c){}else try{A=q(Http.sendRequest("http://untiny.me/api/1.0/extract/?url="+k+"&format=text",false))}catch(h){}return A}function f(k,t){function u(c){c=c.body.match(/<body>([\s\S]*?)<\/body>/m)[1];var h;if(h=c.match(/<!\[CDATA\[([\s\S]*?)\]\]>/m))c=h[1].replace(/<\/(?:p|div|blockquote)>/g,"\n").replace(/<[\s\S]+?>/mg,"");c+="\n"+k;return q[w]=c}var q=i,w=k.match(/^https?:\/\/post\.ly\/(.+)$/)[1],A=k;if(q[w])A=q[w];else if(t)try{Http.sendRequestAsync("http://posterous.com/api/getpost?id="+
w,false,u)}catch(G){}else try{A=u(Http.sendRequest("http://posterous.com/api/getpost?id="+w,false))}catch(a){}return A}var g,l={"http://c4se.tk/":"http://c4se.sakura.ne.jp/"},i={};try{Http.sendRequestAsync("http://untiny.me/api/1.0/services/?format=text",true,d)}catch(v){}AzureaUtil.event.addEventListener("PreProcessTimelineStatus",function(k){k.text=k.text.replace(/https?:\/\/[0-9A-Za-z._\-^~\/&%?]+/g,function(t){return t.indexOf("post.ly")!==-1?f(t,true):b(t,true)})});AzureaVim.prototype.unshorten=
function(){var k=this.status_urls[this.command[1]||0];this.item.text=k.indexOf("post.ly")!==-1?this.status_text.replace(k,f(k,false)):this.status_text.replace(k,b(k,false))};AzureaVim.prototype.unshorten.unshorten=b})();AzureaUtil.mixin(AzureaVim.commands_list,{open:"open",o:"open","\u304a":"open",url:"open url","\u3046\uff52\uff4c":"open url"});
(function(){function d(){var b;switch(d.c1[this.command[1]]){case "status":b="https://twitter.com/"+this.screen_name+"/status/"+this.status_id;break;case "favstar":b="http://favstar.fm/t/"+this.status_id;break;case "favotter":b="http://favotter.net/status.php?id="+this.status_id;break;case "favlook":b="http://favlook.osa-p.net/status.html?status_id="+this.status_id;break;case "twistar":b="http://twistar.cc/"+this.screen_name+"/status/"+this.status_id;break;case "favolog":b="http://favolog.org/"+(this.command[2]||
this.screen_name);break;case "twilog":b="http://twilog.org/"+(this.command[2]||this.screen_name);break;case "user":b="http://twitter.com/"+(this.command[2]||this.screen_name);break;case "url":this.command[2]||(this.command[2]=0);b=this.status_urls[this.command[2]];break;default:b=this.status_urls[0]?this.status_urls[0]:"https://twitter.com/"+this.screen_name+"/status/"+this.status_id}b=b;var f;b=e(b,true);(f=System.getPreviewUrl(b))?System.showPreview(b,f):System.openUrl(b)}var e=AzureaVim.prototype.unshorten?
AzureaVim.prototype.unshorten.unshorten:function(b){return b};d.c1={status:"status",favstar:"favstar",fav:"favstar",f:"favstar",favotter:"favotter",favlook:"favlook",twistar:"twistar",favolog:"favolog",twilog:"twilog",user:"user",u:"user",url:"url"};AzureaVim.prototype.open=d;System.addKeyBindingHandler(190,0,function(b){TwitterService.status.update(":o",b)})})();
AzureaUtil.mixin(AzureaVim.commands_list,{reply:"reply",r:"reply","\uff52":"reply","@":"reply","\uff20":"reply",quotetweet:"reply quote",qt:"reply quote","\uff51\uff54":"reply quote",mrt:"reply mrt","\uff4d\uff52\uff54":"reply mrt"});
(function(){function d(){function e(){TextArea.text=g.text;TextArea.in_reply_to_status_id=b===true?f:0;TextArea.show();TextArea.setFocus();TextArea.cursor=g.cursor}var b=this.command[3]==="true",f=this.status_id,g;if(this.command[1]==="template"){g=AzureaUtil.template.expand(this.command[2],this);Http.sendRequestAsync("http://google.com/",false,e)}else{redirect=this.reply.templates[this.reply.c1[this.command[1]]]||["@#{screen_name} #{}#{status_hashes.length ? ' ' + status_hashes.join(' ') : ''}",
true];if(typeof redirect==="function")redirect=redirect.call(this);this.command=["reply","template",redirect[0],redirect[1]?"true":"false"];this.reply()}}d.c1={template:"template",all:"all",quote:"quote",qt:"quote",mrt:"mrt",masirosiki:"mrt"};d.templates={all:["@#{screen_name + (status_users.length ? ' @' +status_users.join(' @') : '')} #{}",true],quote:["@#{screen_name} #{} RT: #{status_text}",true],mrt:function(){return this.command[2]==="f"||this.command[2]==="fav"||this.command[2]==="favstar"?
["reply","template","#{} MRT: #{'http://favstar.fm/t/' + status_id}","false"]:["reply","template","#{} MRT: #{'http://twitter.com/' + screen_name + '/status/' + status_id}","false"]}};AzureaVim.prototype.reply=d;System.addKeyBindingHandler(82,0,function(e){var b=TwitterService.status.get(e).user.screen_name,f=[];TwitterService.status.getHashes(e,f);TextArea.text="@"+b+" "+(f.length?" "+f.join(" "):"");TextArea.in_reply_to_status_id=e;TextArea.show();TextArea.setFocus();TextArea.cursor=b.length+2})})();
AzureaUtil.mixin(AzureaVim.commands_list,{retweet:"retweet",rt:"retweet","\uff52\uff54":"retweet"});AzureaVim.prototype.retweet=function(){TwitterService.retweet.create(this.status_id)};AzureaUtil.mixin(AzureaVim.commands_list,{settings:"settings",setting:"settings",set:"settings","\u305b\uff54":"settings",get:"settings","\u3052\uff54":"settings"});
AzureaVim.prototype.settings=function(){var d;d=this.command.slice(1).join("");d=d.split("::");d=[d[0]].concat(d[1].split("="));if(/^(?:get|\u3052\uff54)/.test(this.command[0]))d.length=2;if(d[2]){System.settings.setValue(d[0],d[1],d[2]);System.showNotice("Setting done: "+d[0]+"::"+d[1]+"="+d[2])}else System.showNotice("Getting done: "+d[0]+"::"+d[1]+"="+System.settings.getValue(d[0],d[1]))};AzureaUtil.mixin(AzureaVim.commands_list,{shindan:"shindanmaker","\u3057\u3093\u3060\uff4e":"shindanmaker"});
AzureaVim.prototype.shindanmaker=function(){for(var d,e=-1,b=this.unshorten?this.unshorten.unshorten:function(f){return f};d=b(this.status_urls[++e],true);)if(d.match("^http://shindanmaker.com/[0-9]+"))break;if(d)Http.postRequestAsync(d,"u="+encodeURI(this.command[1]||TwitterService.currentUser.screen_name),false,function(f){f.body.match("<textarea.*?>(.*?)</textarea>");TextArea.text=RegExp.$1;TextArea.in_reply_to_status_id=0;TextArea.show();TextArea.setFocus()})};
AzureaUtil.mixin(AzureaVim.commands_list,{translate:"translate",ja:"translate ja","\u3058\u3083":"translate ja"});
AzureaVim.prototype.translate=function(){var d=System.views.currentView,e=d.getItem(d.selectedItemId);this.command[1]||(this.command[1]="ja");Http.sendRequestAsync("https://www.googleapis.com/language/translate/v2?key=AIzaSyCva1yUIFIBRqXOZDJ0nrbGbm0bz3FIksc&q="+encodeURI(this.status_text)+"&target="+this.command[1],false,function(b){if(b.statusCode!==200)throw Error("Google Translate API Error. statusCode is "+b.statusCode+".");e.text=b.body.match(/"translatedText"\s*:\s*"(.*)"/)[1]})};
AzureaUtil.mixin(AzureaVim.commands_list,{view:"view",v:"view",home:"view home","\u307b\u3081":"view home",user:"view user","\u3046\u305b\uff52":"view user"});
AzureaVim.prototype.view=function(){switch(this.view.c1[this.command[1]]){case "home":System.views.openView(0);break;case "mention":System.views.openView(1);break;case "message":System.views.openView(2);break;case "user":System.views.openView(5,this.command[2]||this.screen_name);break;case "search":System.views.openView(4,this.command[2]);break;case "favorite":System.views.openView(3);break;case "match":System.views.openView(6,this.command[2]);break;case "following":System.views.openView(8);break;
case "followers":System.views.openView(9)}};AzureaVim.prototype.view.c1={home:"home",timeline:"home",h:"home",mention:"mention",reply:"mention",r:"mention",m:"mention","@":"mention",message:"message",dm:"message",d:"message",user:"user",u:"user",search:"search",favorite:"favorite",fav:"favorite",f:"favorite",match:"match",following:"following",follow:"following",followers:"followers",follower:"followers",followed:"followers"};
AzureaUtil.mixin(AzureaVim.commands_list,{earthquake:"earthquake",jisin:"earthquake","\u3048\u3042\uff52\uff54\uff48\u304f\u3042\u3051":"earthquake","\u3058\u3057\uff4e":"earthquake"});
(function(){function d(b){var f=AzureaUtil.db.get("EarthquakeMessage");if(b!=null)f=AzureaUtil.template.expand(f,b).text;return f}function e(b){b=b||AzureaUtil.db.get("EarthquakeMessage");AzureaUtil.db.set("EarthquakeMessage",b);return b}AzureaUtil.db.get("EarthquakeMessage")||AzureaUtil.db.set("EarthquakeMessage","\u5730\u9707\u306a\u3046 #{Date()}");AzureaVim.prototype.earthquake=function(){var b;switch(this.command[1]){case "set":if(this.command[2])b=e(this.command[2]);else{b=System.inputBox("\u5730\u9707\u306a\u3046\u6295\u7a3f\u6587",
d(),false);e(b);b=b}b=b;break;default:TwitterService.status.update(d(this),0)}return b};System.addKeyBindingHandler(40,2,function(){TwitterService.status.update(":earthquake",0)})})();AzureaUtil.mixin(AzureaVim.commands_list,{delay:"delay","\u3067\u3041\uff59":"delay"});
(function(){function d(e,b,f){Http.postRequestAsync("http://twitdelay.appspot.com/api/post","user_id="+TwitterService.currentUser.id+"&api_key="+AzureaUtil.db.get("DelayTwitDelayApiKey")+"&status="+e+"&at="+b,false,f)}AzureaUtil.db.get("DelayUseTwitDelay")&&AzureaUtil.db.set("DelayUseTwitDelay","0");AzureaVim.prototype.delay=function(){var e,b;if(e=this.command[1].match(/^(?:(?:(\d{4})-)?(\d{1,2})-(\d{1,2}) )?(\d{1,2}):(\d{1,2})(?::(\d{1,2}))?$/)){b=new Date;e[1]&&b.setFullYear(e[1]);e[2]&&b.setMonth(e[2]-
1);e[3]&&b.setDate(e[3]);b.setHours(e[4]);b.setMinutes(e[5]);b.setSeconds(0);e[6]&&b.setSeconds(e[6]);this.command[1]=b.getTime();e=2}else{this.command[1]=(new Date).getTime()+(this.command[1]-0);e=1}this.command[2]=this.command.slice(2).join(" ");if(AzureaUtil.db.get("DelayUseTwitDelay")){b=new Date(this.command[1]);d(this.command[2],b.getUTCDate()+" "+b.getUTCMonth()+" "+b.getUTCFullYear()+" "+b.getUTCHours()+":"+b.getUTCMinutes()+":"+b.getUTCSeconds()+" +0000",function(){})}else e===1?AzureaUtil.time.setTimeout(function(f){return function(){TwitterService.status.update(f.command[2],
f.status_id)}}(this),this.command[1]-(new Date).getTime()):AzureaUtil.time.setTimeevent('function() {TwitterService.status.update("'+this.command[2]+'", "'+this.status_id+'");}',this.command[1])}})();AzureaUtil.mixin(AzureaVim.codelist,{});System.addKeyBindingHandler(67,2,function(d){d=TwitterService.status.get(d).text;System.clipboard=d;AzureaUtil.yank.set(null,d)});AzureaUtil.mixin(AzureaVim.commands_list,{notify:"notify"});
(function(){function d(l,i){i=i||"";if(l){f=RegExp(l,i);AzureaUtil.db.set("NotifyPattern",l);AzureaUtil.db.set("NotifyPatternOption",i)}else f=null;return f}var e=AzureaUtil.db.get("NotifyPattern"),b=AzureaUtil.db.get("NotifyPatternOption"),f=null,g={faved:AzureaUtil.db.get("NotifyWhenFaved"),mention:AzureaUtil.db.get("NotifyWhenMention"),matched:AzureaUtil.db.get("NotifyWhenMatched")};if(e)f=RegExp(e,b);AzureaVim.prototype.notify=function(){function l(k){var t,u=k.match(/^\/(.*)\/([a-zA-Z]*)$/);
if(u){k=u[1];t=u[2].toLowerCase()}return[k,t]}var i,v;i={faved:"Faved",fav:"Faved",f:"Faved",mention:"Mention",reply:"Mention",r:"Mention","@":"Mention",matched:"Matched",match:"Matched",m:"Matched"};switch({pattern:"pattern",when:"when",growl:"growl",gntp:"growl"}[this.command[1]]){case "pattern":if(i=this.command.slice(2).join(" "))i=l(i);else{i=AzureaUtil.db.get("NotifyPattern");v=AzureaUtil.db.get("NotifyPatternOption");i=l(System.inputBox("tweet\u306b\u30de\u30c3\u30c1\u3055\u305b\u308b\u6b63\u898f\u8868\u73fe",
v?"/"+i+"/"+v:i,false))}v=i[1];i=i[0];d(i,v);break;case "when":i=i[this.command[2]];AzureaUtil.db.set("NotifyWhen"+i,this.command[3]||System.inputBox(i,AzureaUtil.db.get("NotifyWhen"+i),true)?"1":"0");break;case "growl":AzureaUtil.db.set("NotifyUseGrowl",this.command[2]||System.inputBox("NotifyUseGrowl",AzureaUtil.db.get("NotifyUseGrowl"),true)?"1":"0")}};AzureaUtil.event.addEventListener("ReceiveFavorite",function(l,i,v){g.faved&&AzureaUtil.notify("Favs@"+l.screen_name+": "+v.text,"Favs - AzureaVim",
l.profile_image_url,false)});AzureaUtil.event.addEventListener("PreFilterProcessTimelineStatus",function(l){var i=l.text;l=l.user;g.mention&&i.indexOf(TwitterService.currentUser.screen_name)!==-1&&AzureaUtil.notify("Mention@"+l.screen_name+": "+i,"Mention - AzureaVim",l.profile_image_url,false);g.matched&&f&&f.test(i)&&AzureaUtil.notify("Matches@"+l.screen_name+": "+i,"Matched - AzureaVim",l.profile_image_url,false)})})();
