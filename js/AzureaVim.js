// ==AzureaScript==
// @name AzureaVim
// @author http://c4se.sakura.ne.jp/profile.html
// @scriptUrl https://github.com/ne-sachirou/AzureaVim/raw/master/js/
// @date 2011-04-06
// @license MIT License
// ==/AzureaScript==
AzureaUtil={mixin:{},ApiProxy:{},db:{},retweet:{},favorite:{},event:{},time:{},template:{},yank:{},notify:{}};
(function(){function d(a,b,e){var h;if(e==null)e=true;for(h in b)if(e||typeof a[h]==="undefined")a[h]=b[h]}function f(a){if(!(this instanceof f))return new f(a);a=a||"";this.uri=C+a;return this}function c(a,b){System.settings.setValue("user.AzureaVim",a,encodeURIComponent(b));p[a]=b}function j(a){p[a]||(p[a]=decodeURIComponent(System.settings.getValue("user.AzureaVim",a)));return p[a]}function g(a){System.settings.setValue("user.AzureaVim",a,"");delete p[a]}function l(a){for(var b=TwitterService.status.get(a),
e=B.preCreateFavorite,h=B.postCreateFavorite,q=false,k=-1;e[++k];)q=e[k](b)||q;if(!q){TwitterService.favorite.create(a);for(k=-1;h[++k];)h[k](b)}}function m(a){for(var b=TwitterService.status.get(a),e=B.preDestroyFavorite,h=B.postDestroyFavorite,q=false,k=-1;e[++k];)q=e[k](b)||q;if(!q){TwitterService.favorite.destroy(a);for(k=-1;h[++k];)h[k](b)}}function n(a){for(var b=TwitterService.status.get(a),e=I.preCreateRetweet,h=I.postCreateRetweet,q=false,k=-1;e[++k];)q=e[k](b)||q;if(!q){TwitterService.retweet.create(a);
for(k=-1;h[++k];)h[k](b)}}function i(a,b){for(var e=u[a],h=-1;e[++h];)e[h]===b&&e.splice(h,1);e.push(b)}function s(){var a=(new Date).getTime(),b;for(b in F)if(F[b][0]<=a){F[b][1]();delete F[b]}for(b in x)if(x[b][0]<=a){x[b][0]=a+x[b][2];x[b][1]()}for(b in timeevent_list)if(timeevent_list[b][0]<=a){timeevent_list[b][1]();g("TimeEvent"+timeevent_list[b][2]);delete timeevent_list[b]}}function y(a,b){System.isActive?System.showNotice(b):System.showMessage(a,b,1048576)}function z(a,b,e,h){a={title:a,
text:b,sticky:h?"on":null};a[/^https?:\/\/./.test(e)?"icon_uri":"twitter_screen_name"]=e;L.submit(null,a,function(q){try{var k=JSON.parse(q.body);k.error&&y(null,k.request.text)}catch(o){y(null,o.message+q.body)}})}JSON={};(function(){function a(t){return t<10?"0"+t:t}function b(t){q.lastIndex=0;return q.test(t)?'"'+t.replace(q,function(G){var w=v[G];return typeof w==="string"?w:"\\u"+("0000"+G.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+t+'"'}function e(t,G){var w,D,H,K,J=k,E,r=G[t];if(r&&typeof r===
"object"&&typeof r.toJSON==="function")r=r.toJSON(t);if(typeof A==="function")r=A.call(G,t,r);switch(typeof r){case "string":return b(r);case "number":return isFinite(r)?String(r):"null";case "boolean":case "null":return String(r);case "object":if(!r)return"null";k+=o;E=[];if(Object.prototype.toString.apply(r)==="[object Array]"){K=r.length;for(w=0;w<K;w+=1)E[w]=e(w,r)||"null";H=E.length===0?"[]":k?"[\n"+k+E.join(",\n"+k)+"\n"+J+"]":"["+E.join(",")+"]";k=J;return H}if(A&&typeof A==="object"){K=A.length;
for(w=0;w<K;w+=1)if(typeof A[w]==="string"){D=A[w];if(H=e(D,r))E.push(b(D)+(k?": ":":")+H)}}else for(D in r)if(Object.prototype.hasOwnProperty.call(r,D))if(H=e(D,r))E.push(b(D)+(k?": ":":")+H);H=E.length===0?"{}":k?"{\n"+k+E.join(",\n"+k)+"\n"+J+"}":"{"+E.join(",")+"}";k=J;return H}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+
":"+a(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var h=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,q=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,k,o,v={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},A;if(typeof JSON.stringify!==
"function")JSON.stringify=function(t,G,w){var D;o=k="";if(typeof w==="number")for(D=0;D<w;D+=1)o+=" ";else if(typeof w==="string")o=w;if((A=G)&&typeof G!=="function"&&(typeof G!=="object"||typeof G.length!=="number"))throw Error("JSON.stringify");return e("",{"":t})};if(typeof JSON.parse!=="function")JSON.parse=function(t,G){function w(H,K){var J,E,r=H[K];if(r&&typeof r==="object")for(J in r)if(Object.prototype.hasOwnProperty.call(r,J)){E=w(r,J);if(E!==undefined)r[J]=E;else delete r[J]}return G.call(H,
K,r)}var D;t=String(t);h.lastIndex=0;if(h.test(t))t=t.replace(h,function(H){return"\\u"+("0000"+H.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(t.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){D=eval("("+t+")");return typeof G==="function"?w({"":D},""):D}throw new SyntaxError("JSON.parse");}})();AzureaUtil.mixin=d;var C="http://localhost:80/";f.prototype={submit:function(a,
b,e){var h,q=this.uri,k=[],o;for(o in b)b[o]&&k.push(o+"="+b[o]);k=encodeURI(k.join("&"));a=(a=a||"")?/\/$/.test(q)&&a.charAt(0)==="/"?q.substring(1)+a:!/\/$/.test(q)&&a.charAt(0)!=="/"?q+"/"+a:q+a:q;if(e&&b)Http.postRequestAsync(a,k,false,e);else if(e)Http.sendRequestAsync(a,false,e);else h=b?Http.postRequest(a,k,false):Http.sendRequest(a,false);return h}};AzureaUtil.ApiProxy=f;var p={};d(AzureaUtil.db,{get:j,set:c,del:g,keys:function(){var a,b=[];for(a in p)match.test(a)&&b.push(a);return b}});
var B={preCreateFavorite:[],postCreateFavorite:[],preDestroyFavorite:[],postDestroyFavorite:[]};System.addKeyBindingHandler(70,0,function(a){TwitterService.status.get(a).favorited?m(a):l(a)});d(AzureaUtil.favorite,{addEventListener:function(a,b){var e=B[a],h=-1;if(e){for(;e[++h];)e[h]===b&&e.splice(h,1);e.push(b)}},removeEventListener:function(a,b){for(var e=B[a],h=-1;e[++h];)if(e[h]===b){e.splice(h,1);break}},create:l,destroy:m});var I={preCreateRetweet:[],postCreateRetweet:[]};System.addKeyBindingHandler(84,
0,function(a){var b=TwitterService.status.get(a);if(System.settings.getValue("Misc","UseQT")){TextArea.text="RT @"+b.user.screen_name+": "+b.text;TextArea.show();TextArea.setFocus()}else System.showMessage("\u9078\u629e\u9805\u76ee\u3092\u30ea\u30c4\u30a4\u30fc\u30c8\u3057\u307e\u3059\u3002\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f","\u78ba\u8a8d",4)===6&&n(a)});System.addKeyBindingHandler(87,0,function(a){var b=TwitterService.status.get(a);if(System.settings.getValue("Misc","UseQT"))System.showMessage("\u9078\u629e\u9805\u76ee\u3092\u30ea\u30c4\u30a4\u30fc\u30c8\u3057\u307e\u3059\u3002\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f",
"\u78ba\u8a8d",4)===6&&n(a);else{TextArea.text="RT @"+b.user.screen_name+": "+b.text;TextArea.show();TextArea.setFocus()}});d(AzureaUtil.retweet,{addEventListener:function(a,b){var e=I[a],h=-1;if(e){for(;e[++h];)e[h]===b&&e.splice(h,1);e.push(b)}},removeEventListener:function(a,b){for(var e=I[a],h=-1;e[++h];)if(e[h]===b){e.splice(h,1);break}},create:n});var u={PreProcessTimelineStatuses:[],PreProcessTimelineStatus:[],PreFilterProcessTimelineStatus:[],PostFilterProcessTimelineStatus:[],PostProcessTimelineStatus:[],
PostProcessTimelineStatuses:[],PreSendUpdateStatus:[],PostSendUpdateStatus:[],ReceiveFavorite:[]};d(AzureaUtil.event,{PreProcessTimelineStatuses:u.PreProcessTimelineStatuses,PreProcessTimelineStatus:u.PreProcessTimelineStatus,PreFilterProcessTimelineStatus:u.PreFilterProcessTimelineStatus,PostFilterProcessTimelineStatus:u.PostFilterProcessTimelineStatus,PostProcessTimelineStatus:u.PostProcessTimelineStatus,PostProcessTimelineStatuses:u.PostProcessTimelineStatuses,PreSendUpdateStatus:u.PreSendUpdateStatus,
PostSendUpdateStatus:u.PostSendUpdateStatus,ReceiveFavorite:u.ReceiveFavorite,addEventListener:i,removeEventListener:function(a,b){for(var e=u[a],h=-1;e[++h];)if(e[h]===b){e.splice(h,1);break}}});var F={},x={};timeevent_list=function(){for(var a={},b,e=-1;b=j("TimeEvent"+ ++e);)a[b.substring(0,b.indexOf(":"))]=[b.substring(b.indexOf(":")+1,b.indexOf("|"))-0,eval("(function(){return "+b.substring(b.indexOf("|")+1)+"})()"),e];return a}();i("PreProcessTimelineStatus",s);i("PostSendUpdateStatus",s);i("ReceiveFavorite",
s);d(AzureaUtil.time,{setTimeout:function(a,b){var e=Math.floor(Math.random()*(new Date).getTime()).toString(36);F[e]=[(new Date).getTime()+b,a];return e},clearTimeout:function(a){delete F[a]},setInterval:function(a,b){var e=Math.floor(Math.random()*(new Date).getTime()).toString(36);timeinterval_list[e]=[(new Date).getTime()+b,a,b];return e},clearInterval:function(a){delete timeinterval_list[a]},setTimeevent:function(a,b){for(var e=Math.floor(Math.random()*(new Date).getTime()).toString(36),h=-1;j("TimeEvent"+
++h););c("TimeEvent"+h,e+":"+b+"|"+a);timeevent_list[e]=[b,eval("(function(){return "+a+"})()"),h];return e},clearTimeevent:function(a){g("TimeEvent"+timeevent_list[a][2]);delete timeevent_list[a]}});d(AzureaUtil.template,{expand:function(a,b){function e(o){var v,A,t;if(typeof o==="string"||o instanceof String)v='"'+o.replace('"','\\"')+'"';else if(typeof o==="number"||o instanceof Number)v=o.toString(10);else if(o===true||o===false)v=o;else if(o===null)v="null";else if(typeof o==="undefined")v="void(0)";
else if(o instanceof Array){v="[";A=0;for(t=o.length;A<t;++A)v+=e(o[A])+",";v=v.replace(/,$/,"")+"]"}else{v="{";for(A in o)if(o.hasOwnProperty(A))v+='"'+A+'":'+e(o[A])+",";v=v.replace(/,$/,"")+"}"}return v}var h,q=function(){var o,v="";for(o in b)if(b.hasOwnProperty(o))v+="var "+o+"="+e(b[o])+";";return v}(),k=a.replace(/#{([^}]+?)}/g,function(o,v){return eval("(function(){"+q+"return ("+v+")})()")});k=k.split("#{}");if(k.length===1){h=0;k=k[0]}else{h=k[0].length;k=k.join("")}return{text:k,cursor:h}}});
d(AzureaUtil.yank,{get:function(a){if(a){a=a.charAt(0);if(/[0-9A-Za-z]/.test(a))a=""}else a="";return j("Yank"+a)},set:function(a,b){if(a){a=a.charAt(0);if(/[0-9A-Za-z]/.test(a))a=""}else a="";c("Yank"+a,b);return b}});var L=new f("gntp");j("NotifyUseGrowl")||c("NotifyUseGrowl","0");AzureaUtil.notify=function(a,b,e,h){var q=System.systemInfo<=2&&j("NotifyUseGrowl")!=="0";try{q?z(b,a,e,h):y(b,a)}catch(k){y(b,a)}}})();
function PreProcessTimelineStatus(d){for(var f=AzureaUtil.event.PreProcessTimelineStatus,c=-1;f[++c];)f[c](d)}function PreFilterProcessTimelineStatus(d){for(var f=AzureaUtil.event.PreFilterProcessTimelineStatus,c=-1,j,g=false;f[++c];){j=f[c](d);g=g||j}return g}function PreSendUpdateStatus(d){for(var f=AzureaUtil.event.PreSendUpdateStatus,c=-1,j,g=false;f[++c];){j=f[c](d);g=g||j}return g}function PostSendUpdateStatus(){for(var d=AzureaUtil.event.PostSendUpdateStatus,f=-1;d[++f];)d[f]()}
function ReceiveFavorite(d,f,c){for(var j=AzureaUtil.event.ReceiveFavorite,g=-1;j[++g];)j[g](d,f,c)}AzureaVim={};
(function(){function d(g){var l=System.inputBox("command","",true),m=System.views.currentView;j=m.getItem(m.selectedItemId);AzureaUtil.yank.set(null,l);(new f({text:":"+l,in_reply_to_status_id:g||m.selectedStatusId})).run()}function f(g){var l=TwitterService.status,m=g.in_reply_to_status_id,n=l.get(m);this.item=j;g=this.command_text=g.text.slice(1);var i=[],s,y=/[^\s"]+|\s+|"[^\\"]*(?:\\.[^\\"]*)*"/g;for(g=g.replace(/^\s+|\s+$/g,"");s=y.exec(g);)/^\s/.test(s[0])||i.push(s[0].replace(/^"|"$/g,""));
this.command=i;this.status_id=m;this.user=n.user;this.screen_name=n.user.screen_name;this.status=n;this.status_text=n.text;this.status_urls=[];this.status_hashes=[];this.status_users=[];l.getUrls(m,this.status_urls);l.getHashes(m,this.status_hashes);l.getUsers(m,this.status_users)}var c={},j;System.addKeyBindingHandler(186,0,function(g){var l=System.views.currentView;j=l.getItem(l.selectedItemId);AzureaUtil.yank.set(null,TextArea.text);TextArea.text=":";TextArea.in_reply_to_status_id=g;TextArea.show();
TextArea.setFocus();TextArea.cursor=1});System.addKeyBindingHandler(186,2,d);System.addContextMenuHandler(":vim",0,d);AzureaUtil.event.addEventListener("PreSendUpdateStatus",function(g){var l,m=false;try{if(g.text===":"){m=true;AzureaUtil.time.setTimeout(function(){TextArea.text=AzureaUtil.yank.get(null);TextArea.show()},0)}else if(/^(?::|\uff1a)/.test(g.text)){m=true;AzureaUtil.yank.set(null,g.text);l=new f(g);TextArea.text="";TextArea.in_reply_to_status_id=0;l.run()}else AzureaUtil.yank.set(null,
g.text)}catch(n){System.alert(n.name+":\n"+n.message);m=true}return m});AzureaVim=f;AzureaVim.commands_list=c;AzureaVim.prototype={run:function(){var g=this.command,l=c[this.command[0]];if(l){if(l.indexOf(" ")!==-1){g.shift();g=this.command=l.split(" ").concat(g);l=g[0]}this[l]()}else System.showNotice(":"+g[0]+" command is undefined.")}}})();AzureaUtil.mixin(AzureaVim.commands_list,{eval:"_evaluate"});
AzureaVim.prototype._evaluate=function(){this.command[1]=this.command.slice(1).join(" ");System.inputBox(this.command[1],eval(this.command[1]),false)};AzureaUtil.mixin(AzureaVim.commands_list,{unshorten:"unshorten","\u3046\u3093\u3057\u3087\uff52\u3066\uff4e":"unshorten"});
(function(){function d(i){g=i.body.split(", ");g.push("htn.to")}function f(i){for(var s=g,y=-1,z=false;s[++y];)if(i.indexOf(s[y])!==-1){z=true;break}return z}function c(i,s){function y(x){C=(x=x.header.match(/Location: ([^\n]+)\n/))?x[1]:i;x=x?x[1]:i;return C[i]=x}function z(x){x=/^error/.test(x.body)?i:x.body;return C[i]=x}var C=l,p=i;if(C[i])p=C[i];else if(i.indexOf("htn.to")!==-1)if(s)try{Http.sendRequestAsync(i,false,y)}catch(B){}else try{p=callback_htly(Http.sendRequest(i,false))}catch(I){}else if(f(i))if(s)try{Http.sendRequestAsync("http://untiny.me/api/1.0/extract/?url="+
i+"&format=text",false,z)}catch(u){}else try{p=z(Http.sendRequest("http://untiny.me/api/1.0/extract/?url="+i+"&format=text",false))}catch(F){}return p}function j(i,s){function y(u){u=u.body.match(/<body>([\s\S]*?)<\/body>/m)[1];var F;if(F=u.match(/<!\[CDATA\[([\s\S]*?)\]\]>/m))u=F[1].replace(/<\/(?:p|div|blockquote)>/g,"\n").replace(/<[\s\S]+?>/mg,"");u+="\n"+i;return z[C]=u}var z=m,C=i.match(/^https?:\/\/post\.ly\/(.+)$/)[1],p=i;if(z[C])p=z[C];else if(s)try{Http.sendRequestAsync("http://posterous.com/api/getpost?id="+
C,false,y)}catch(B){}else try{p=y(Http.sendRequest("http://posterous.com/api/getpost?id="+C,false))}catch(I){}return p}var g,l={"http://c4se.tk/":"http://c4se.sakura.ne.jp/"},m={};try{Http.sendRequestAsync("http://untiny.me/api/1.0/services/?format=text",true,d)}catch(n){}AzureaUtil.event.addEventListener("PreProcessTimelineStatus",function(i){i.text=i.text.replace(/https?:\/\/[0-9A-Za-z._\-^~\/&%?]+/g,function(s){return s.indexOf("post.ly")!==-1?j(s,true):c(s,true)})});AzureaVim.prototype.unshorten=
function(){var i=this.status_urls[this.command[1]||0];this.item.text=i.indexOf("post.ly")!==-1?this.status_text.replace(i,j(i,false)):this.status_text.replace(i,c(i,false))};AzureaVim.prototype.unshorten.unshorten=c})();AzureaUtil.mixin(AzureaVim.commands_list,{open:"open",o:"open","\u304a":"open",url:"open url","\u3046\uff52\uff4c":"open url"});
(function(){function d(){var c=d.c1[this.command[1]]?d.addresses[d.c1[this.command[1]]].call(this):this.status_urls[0]?this.status_urls[0]:"https://twitter.com/"+this.screen_name+"/status/"+this.status_id,j;c=f(c,true);(j=System.getPreviewUrl(c))?System.showPreview(c,j):System.openUrl(c)}var f=AzureaVim.prototype.unshorten?AzureaVim.prototype.unshorten.unshorten:function(c){return c};d.c1={status:"status",favstar:"favstar",fav:"favstar",f:"favstar",favotter:"favotter",favlook:"favlook",twistar:"twistar",
favolog:"favolog",twilog:"twilog",user:"user",u:"user",url:"url"};d.addresses={status:function(){return"https://twitter.com/"+this.screen_name+"/status/"+this.status_id},favstar:function(){return"http://favstar.fm/t/"+this.status_id},favotter:function(){return"http://favotter.net/status.php?id="+this.status_id},favlook:function(){return"http://favlook.osa-p.net/status.html?status_id="+this.status_id},twistar:function(){return"http://twistar.cc/"+this.screen_name+"/status/"+this.status_id},twilog:function(){return"http://twilog.org/"+
(this.command[2]||this.screen_name)},user:function(){return"http://twitter.com/"+(this.command[2]||this.screen_name)},url:function(){return this.status_urls[this.command[2]||0]}};AzureaVim.prototype.open=d;System.addKeyBindingHandler(190,0,function(c){TwitterService.status.update(":o",c)})})();AzureaUtil.mixin(AzureaVim.commands_list,{reply:"reply",r:"reply","\uff52":"reply","@":"reply","\uff20":"reply",quotetweet:"reply quote",qt:"reply quote","\uff51\uff54":"reply quote",mrt:"reply mrt","\uff4d\uff52\uff54":"reply mrt"});
(function(){function d(){function f(){TextArea.text=g.text;TextArea.in_reply_to_status_id=c===true?j:0;TextArea.show();TextArea.setFocus();TextArea.cursor=g.cursor}var c,j=this.status_id,g,l;if(this.command[1]==="template"){c=this.command[3]==="true";g=AzureaUtil.template.expand(this.command[2],this);Http.sendRequestAsync("http://google.com/",false,f)}else{l=d.templates[d.c1[this.command[1]]]||["@#{screen_name} #{}#{status_hashes.length ? ' ' + status_hashes.join(' ') : ''}",true];if(typeof l==="function")l=
l.call(this);this.command=["reply","template",l[0],l[1]?"true":"false"];d.call(this)}}d.c1={template:"template",all:"all",quote:"quote",qt:"quote",mrt:"mrt",masirosiki:"mrt"};d.templates={all:["@#{screen_name + (status_users.length ? ' @' +status_users.join(' @') : '')} #{}",true],quote:["@#{screen_name} #{} RT: #{status_text}",true],mrt:function(){return this.command[2]==="f"||this.command[2]==="fav"||this.command[2]==="favstar"?["#{} MRT: #{'http://favstar.fm/t/' + status_id}",false]:["#{} MRT: #{'http://twitter.com/' + screen_name + '/status/' + status_id}",
false]}};AzureaVim.prototype.reply=d;System.addKeyBindingHandler(82,0,function(f){var c=TwitterService.status.get(f).user.screen_name,j=[];TwitterService.status.getHashes(f,j);TextArea.text="@"+c+" "+(j.length?" "+j.join(" "):"");TextArea.in_reply_to_status_id=f;TextArea.show();TextArea.setFocus();TextArea.cursor=c.length+2})})();AzureaUtil.mixin(AzureaVim.commands_list,{retweet:"retweet",rt:"retweet","\uff52\uff54":"retweet"});AzureaVim.prototype.retweet=function(){AzureaUtil.retweet.create(this.status_id)};
AzureaUtil.mixin(AzureaVim.commands_list,{settings:"settings",setting:"settings",set:"settings","\u305b\uff54":"settings",get:"settings","\u3052\uff54":"settings"});
AzureaVim.prototype.settings=function(){var d;d=this.command.slice(1).join("");d=d.split("::");d=[d[0]].concat(d[1].split("="));if(/^(?:get|\u3052\uff54)/.test(this.command[0]))d.length=2;if(d[2]){System.settings.setValue(d[0],d[1],d[2]);System.showNotice("Setting done: "+d[0]+"::"+d[1]+"="+d[2])}else System.showNotice("Getting done: "+d[0]+"::"+d[1]+"="+System.settings.getValue(d[0],d[1]))};AzureaUtil.mixin(AzureaVim.commands_list,{shindan:"shindanmaker","\u3057\u3093\u3060\uff4e":"shindanmaker"});
AzureaVim.prototype.shindanmaker=function(){for(var d,f=-1,c=this.unshorten?this.unshorten.unshorten:function(j){return j};d=c(this.status_urls[++f],true);)if(d.match("^http://shindanmaker.com/[0-9]+"))break;if(d)Http.postRequestAsync(d,"u="+encodeURI(this.command[1]||TwitterService.currentUser.screen_name),false,function(j){j.body.match("<textarea.*?>(.*?)</textarea>");TextArea.text=RegExp.$1;TextArea.in_reply_to_status_id=0;TextArea.show();TextArea.setFocus()})};
AzureaUtil.mixin(AzureaVim.commands_list,{translate:"translate",ja:"translate ja","\u3058\u3083":"translate ja"});
AzureaVim.prototype.translate=function(){var d=System.views.currentView,f=d.getItem(d.selectedItemId);this.command[1]||(this.command[1]="ja");Http.sendRequestAsync("https://www.googleapis.com/language/translate/v2?key=AIzaSyCva1yUIFIBRqXOZDJ0nrbGbm0bz3FIksc&q="+encodeURI(this.status_text)+"&target="+this.command[1],false,function(c){if(c.statusCode!==200)throw Error("Google Translate API Error. statusCode is "+c.statusCode+".");f.text=c.body.match(/"translatedText"\s*:\s*"(.*)"/)[1]})};
AzureaUtil.mixin(AzureaVim.commands_list,{view:"view",v:"view",home:"view home","\u307b\u3081":"view home",user:"view user","\u3046\u305b\uff52":"view user"});
AzureaVim.prototype.view=function(){switch(this.view.c1[this.command[1]]){case "home":System.views.openView(0);break;case "mention":System.views.openView(1);break;case "message":System.views.openView(2);break;case "user":System.views.openView(5,this.command[2]||this.screen_name);break;case "search":System.views.openView(4,this.command[2]);break;case "favorite":System.views.openView(3);break;case "match":System.views.openView(6,this.command[2]);break;case "following":System.views.openView(8);break;
case "followers":System.views.openView(9)}};AzureaVim.prototype.view.c1={home:"home",timeline:"home",h:"home",mention:"mention",reply:"mention",r:"mention",m:"mention","@":"mention",message:"message",dm:"message",d:"message",user:"user",u:"user",search:"search",favorite:"favorite",fav:"favorite",f:"favorite",match:"match",following:"following",follow:"following",followers:"followers",follower:"followers",followed:"followers"};
AzureaUtil.mixin(AzureaVim.commands_list,{earthquake:"earthquake",jisin:"earthquake","\u3048\u3042\uff52\uff54\uff48\u304f\u3042\u3051":"earthquake","\u3058\u3057\uff4e":"earthquake"});
(function(){function d(c){var j=AzureaUtil.db.get("EarthquakeMessage");if(c!=null)j=AzureaUtil.template.expand(j,c).text;return j}function f(c){c=c||AzureaUtil.db.get("EarthquakeMessage");AzureaUtil.db.set("EarthquakeMessage",c);return c}AzureaUtil.db.get("EarthquakeMessage")||AzureaUtil.db.set("EarthquakeMessage","\u5730\u9707\u306a\u3046 #{Date()}");AzureaVim.prototype.earthquake=function(){var c;switch(this.command[1]){case "set":if(this.command[2])c=f(this.command[2]);else{c=System.inputBox("\u5730\u9707\u306a\u3046\u6295\u7a3f\u6587",
d(),false);f(c);c=c}c=c;break;default:TwitterService.status.update(d(this),0)}return c};System.addKeyBindingHandler(40,2,function(){TwitterService.status.update(":earthquake",0)})})();AzureaUtil.mixin(AzureaVim.commands_list,{delay:"delay","\u3067\u3041\uff59":"delay"});
(function(){function d(f,c,j){Http.postRequestAsync("http://twitdelay.appspot.com/api/post","user_id="+TwitterService.currentUser.id+"&api_key="+AzureaUtil.db.get("DelayTwitDelayApiKey")+"&status="+f+"&at="+c,false,j)}AzureaUtil.db.get("DelayUseTwitDelay")&&AzureaUtil.db.set("DelayUseTwitDelay","0");AzureaVim.prototype.delay=function(){var f,c;if(f=this.command[1].match(/^(?:(?:(\d{4})-)?(\d{1,2})-(\d{1,2}) )?(\d{1,2}):(\d{1,2})(?::(\d{1,2}))?$/)){c=new Date;f[1]&&c.setFullYear(f[1]);f[2]&&c.setMonth(f[2]-
1);f[3]&&c.setDate(f[3]);c.setHours(f[4]);c.setMinutes(f[5]);c.setSeconds(0);f[6]&&c.setSeconds(f[6]);this.command[1]=c.getTime();f=2}else{this.command[1]=(new Date).getTime()+(this.command[1]-0);f=1}this.command[2]=this.command.slice(2).join(" ");if(AzureaUtil.db.get("DelayUseTwitDelay")){c=new Date(this.command[1]);d(this.command[2],c.getUTCDate()+" "+c.getUTCMonth()+" "+c.getUTCFullYear()+" "+c.getUTCHours()+":"+c.getUTCMinutes()+":"+c.getUTCSeconds()+" +0000",function(){})}else f===1?AzureaUtil.time.setTimeout(function(j){return function(){TwitterService.status.update(j.command[2],
j.status_id)}}(this),this.command[1]-(new Date).getTime()):AzureaUtil.time.setTimeevent('function() {TwitterService.status.update("'+this.command[2]+'", "'+this.status_id+'");}',this.command[1])}})();AzureaUtil.mixin(AzureaVim.codelist,{});System.addKeyBindingHandler(67,2,function(d){d=TwitterService.status.get(d).text;System.clipboard=d;AzureaUtil.yank.set(null,d)});AzureaUtil.mixin(AzureaVim.commands_list,{notify:"notify"});
(function(){function d(m,n){n=n||"";if(m){g=RegExp(m,n);AzureaUtil.db.set("NotifyPattern",m);AzureaUtil.db.set("NotifyPatternOption",n)}else g=null;return g}function f(){function m(s){var y,z=s.match(/^\/(.*)\/([a-zA-Z]*)$/);if(z){s=z[1];y=z[2].toLowerCase()}return[s,y]}var n,i;switch(f.c1[this.command[1]]){case "pattern":if(n=this.command.slice(2).join(" "))n=m(n);else{n=AzureaUtil.db.get("NotifyPattern");i=AzureaUtil.db.get("NotifyPatternOption");n=m(System.inputBox("tweet\u306b\u30de\u30c3\u30c1\u3055\u305b\u308b\u6b63\u898f\u8868\u73fe",
i?"/"+n+"/"+i:n,false))}i=n[1];n=n[0];d(n,i);break;case "when":n=f.c2[this.command[2]];if(!n)throw Error("plugins/notify: No such option as NotifyWhen "+this.command[2]);l[n]=(this.command[3]||System.inputBox("NotifyWhen"+n,l[n],true))==="0"?"0":"1";AzureaUtil.db.set("NotifyWhen"+n,l[n]);break;case "growl":AzureaUtil.db.set("NotifyUseGrowl",(this.command[2]||System.inputBox("NotifyUseGrowl",AzureaUtil.db.get("NotifyUseGrowl"),true))==="0"?"0":"1")}}var c=AzureaUtil.db.get("NotifyPattern"),j=AzureaUtil.db.get("NotifyPatternOption"),
g=null,l={Faved:AzureaUtil.db.get("NotifyWhenFaved"),Mention:AzureaUtil.db.get("NotifyWhenMention"),Matched:AzureaUtil.db.get("NotifyWhenMatched")};if(c)g=RegExp(c,j);f.c1={pattern:"pattern",when:"when",growl:"growl",gntp:"growl"};f.c2={faved:"Faved",fav:"Faved",f:"Faved",mention:"Mention",reply:"Mention",r:"Mention","@":"Mention",matched:"Matched",match:"Matched",m:"Matched"};AzureaVim.prototype.notify=f;AzureaUtil.event.addEventListener("ReceiveFavorite",function(m,n,i){l.Faved&&AzureaUtil.notify("Favs@"+
m.screen_name+": "+i.text,"Favs - AzureaVim",m.profile_image_url,false)});AzureaUtil.event.addEventListener("PreFilterProcessTimelineStatus",function(m){var n=l,i=m.text;m=m.user;n.Mention&&i.indexOf(TwitterService.currentUser.screen_name)!==-1&&AzureaUtil.notify("Mention@"+m.screen_name+": "+i,"Mention - AzureaVim",m.profile_image_url,false);n.Matched&&g&&g.test(i)&&AzureaUtil.notify("Matches@"+m.screen_name+": "+i,"Matched - AzureaVim",m.profile_image_url,false)})})();
AzureaUtil.mixin(AzureaVim.commands_list,{tumblr:"tumblr","\u3064\uff4d\uff42\uff4c\uff52":"tumblr"});
(function(){function d(p,B){Http.postRequestAsync("https://www.tumblr.com/api/authenticate","email="+p+"&password="+B,false,function(I){i=200<=I.statusCode||I.statusCode<300?true:false})}function f(p,B,I,u,F,x){function L(a){var b,e=[];for(b in a)a.hasOwnProperty(b)&&e.push(b+"="+encodeURI(a[b]));return e.join("&")}Http.postRequestAsync("https://www.tumblr.com/api/write","email="+p+"&password="+B+"&type="+I+"&"+L(u)+(F?"&"+L(F):""),false,x)}function c(p){if(p.user.protected_)throw Error("plugins/tumblr: "+
p.user.screen_name+" is protected_.");else f(g,l,"quote",{quote:p.text,source:'<a href="http://twitter.com/'+p.user.screen_name+"/"+p.id+'">Twitter:'+p.user.screen_name+"</a>"},{generator:"AzureaVim",tags:n},function(B){if(B.statusCode<200&&300<=B.statusCode)throw Error("plugins/tumblr: Cannot create post. (statusCode="+B.statusCode+")");})}function j(){var p;switch(j.c1[this.command[1]]){case "when":p=j.c2[this.command[2]];if(!p)throw Error("plugins/tumblr: No such option as TumblrWhen "+this.command[2]);
m[p]=(this.command[3]||System.inputBox("TumblrWhen"+p,m[p],true))==="0"?"0":"1";AzureaUtil.db.set("TumblrWhen"+p,m[p]);m.Favorite!=="0"?s("postCreateFavorite",c):y("postCreateFavorite",c);m.Retweet!=="0"?z("postCreateRetweet",c):C("postCreateRetweet",c);break;case "email":g=this.command[2]||System.inputBox("TumblrEmail",g,true);AzureaUtil.db.set("TumblrEmail",g);d(g,l);break;case "password":l=this.command[2]||System.inputBox("TumblrPassword",l,true);AzureaUtil.db.set("TumblrPassword",l);d(g,l);break;
case "tags":n=this.command[2]||System.inputBox("TumblrTags",n,false);AzureaUtil.db.set("TumblrTags",n);break;default:if(!i)throw Error("plugins/tumblr: Authenticate your email & password.");c(this.status)}}var g=AzureaUtil.db.get("TumblrEmail"),l=AzureaUtil.db.get("TumblrPassword"),m={Favorite:AzureaUtil.db.get("TumblrWhenFavorite"),Retweet:AzureaUtil.db.get("TumblrWhenRetweet")},n=AzureaUtil.db.get("TumblrTags"),i=false,s=AzureaUtil.favorite.addEventListener,y=AzureaUtil.favorite.removeEventListener,
z=AzureaUtil.retweet.addEventListener,C=AzureaUtil.retweet.removeEventListener;d(g,l);m.Favorite&&s("postCreateFavorite",c);m.Retweet&&z("postRetweetFavorite",c);j.c1={when:"when",email:"email",password:"password",tags:"tags",tag:"tags"};j.c2={favorite:"Favorite",fav:"Favorite",f:"Favorite",retweet:"Retweet",rt:"Retweet"};AzureaVim.prototype.tumblr=j})();
