// ==AzureaScript==
// @name AzureaVim
// @author http://c4se.sakura.ne.jp/profile.html
// @scriptUrl https://github.com/ne-sachirou/AzureaVim/raw/master/js/
// @date 2011-04-06
// @license MIT License
// ==/AzureaScript==
AzureaUtil={mixin:{},ApiProxy:{},db:{},retweet:{},favorite:{},event:{},time:{},template:{},yank:{},notify:{}};
(function(){function d(a,b,e){var f;if(e==null)e=true;for(f in b)if(e||typeof a[f]==="undefined")a[f]=b[f]}function g(a,b){System.settings.setValue("user.AzureaVim",a,encodeURIComponent(b));q[a]=b}function c(a){q[a]||(q[a]=decodeURIComponent(System.settings.getValue("user.AzureaVim",a)));return q[a]}function j(a){System.settings.setValue("user.AzureaVim",a,"");delete q[a]}function h(a){for(var b=TwitterService.status.get(a),e=v.preCreateFavorite,f=v.postCreateFavorite,y=false,m=-1;e[++m];)y=e[m](b)||
y;if(!y){TwitterService.favorite.create(a);for(m=-1;f[++m];)f[m](b)}}function n(a){for(var b=TwitterService.status.get(a),e=v.preDestroyFavorite,f=v.postDestroyFavorite,y=false,m=-1;e[++m];)y=e[m](b)||y;if(!y){TwitterService.favorite.destroy(a);for(m=-1;f[++m];)f[m](b)}}function k(a){for(var b=TwitterService.status.get(a),e=w.preCreateRetweet,f=w.postCreateRetweet,y=false,m=-1;e[++m];)y=e[m](b)||y;if(!y){TwitterService.retweet.create(a);for(m=-1;f[++m];)f[m](b)}}function l(a,b){for(var e=s[a],f=-1;e[++f];)e[f]===
b&&e.splice(f,1);e.push(b)}function i(){var a=(new Date).getTime(),b;for(b in o)if(o[b][0]<=a){o[b][1]();delete o[b]}for(b in A)if(A[b][0]<=a){A[b][0]=a+A[b][2];A[b][1]()}for(b in timeevent_list)if(timeevent_list[b][0]<=a){timeevent_list[b][1]();j("TimeEvent"+timeevent_list[b][2]);delete timeevent_list[b]}}JSON={};(function(){function a(t){return t<10?"0"+t:t}function b(t){y.lastIndex=0;return y.test(t)?'"'+t.replace(y,function(D){var x=u[D];return typeof x==="string"?x:"\\u"+("0000"+D.charCodeAt(0).toString(16)).slice(-4)})+
'"':'"'+t+'"'}function e(t,D){var x,B,E,G,F=m,C,r=D[t];if(r&&typeof r==="object"&&typeof r.toJSON==="function")r=r.toJSON(t);if(typeof z==="function")r=z.call(D,t,r);switch(typeof r){case "string":return b(r);case "number":return isFinite(r)?String(r):"null";case "boolean":case "null":return String(r);case "object":if(!r)return"null";m+=p;C=[];if(Object.prototype.toString.apply(r)==="[object Array]"){G=r.length;for(x=0;x<G;x+=1)C[x]=e(x,r)||"null";E=C.length===0?"[]":m?"[\n"+m+C.join(",\n"+m)+"\n"+
F+"]":"["+C.join(",")+"]";m=F;return E}if(z&&typeof z==="object"){G=z.length;for(x=0;x<G;x+=1)if(typeof z[x]==="string"){B=z[x];if(E=e(B,r))C.push(b(B)+(m?": ":":")+E)}}else for(B in r)if(Object.prototype.hasOwnProperty.call(r,B))if(E=e(B,r))C.push(b(B)+(m?": ":":")+E);E=C.length===0?"{}":m?"{\n"+m+C.join(",\n"+m)+"\n"+F+"}":"{"+C.join(",")+"}";m=F;return E}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+a(this.getUTCMonth()+
1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var f=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,y=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,m,p,u={"\u0008":"\\b","\t":"\\t","\n":"\\n",
"\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},z;if(typeof JSON.stringify!=="function")JSON.stringify=function(t,D,x){var B;p=m="";if(typeof x==="number")for(B=0;B<x;B+=1)p+=" ";else if(typeof x==="string")p=x;if((z=D)&&typeof D!=="function"&&(typeof D!=="object"||typeof D.length!=="number"))throw Error("JSON.stringify");return e("",{"":t})};if(typeof JSON.parse!=="function")JSON.parse=function(t,D){function x(E,G){var F,C,r=E[G];if(r&&typeof r==="object")for(F in r)if(Object.prototype.hasOwnProperty.call(r,
F)){C=x(r,F);if(C!==undefined)r[F]=C;else delete r[F]}return D.call(E,G,r)}var B;t=String(t);f.lastIndex=0;if(f.test(t))t=t.replace(f,function(E){return"\\u"+("0000"+E.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(t.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){B=eval("("+t+")");return typeof D==="function"?x({"":B},""):B}throw new SyntaxError("JSON.parse");}})();
AzureaUtil.mixin=d;var q={};d(AzureaUtil.db,{get:c,set:g,del:j,keys:function(){var a,b=[];for(a in q)match.test(a)&&b.push(a);return b}});var v={preCreateFavorite:[],postCreateFavorite:[],preDestroyFavorite:[],postDestroyFavorite:[]};System.addKeyBindingHandler(70,0,function(a){TwitterService.status.get(a).favorited?n(a):h(a)});d(AzureaUtil.favorite,{addEventListener:function(a,b){var e=v[a],f=-1;if(e){for(;e[++f];)e[f]===b&&e.splice(f,1);e.push(b)}},removeEventListener:function(a,b){for(var e=v[a],
f=-1;e[++f];)if(e[f]===b){e.splice(f,1);break}},create:h,destroy:n});var w={preCreateRetweet:[],postCreateRetweet:[]};System.addKeyBindingHandler(84,0,function(a){var b=TwitterService.status.get(a);if(System.settings.getValue("Misc","UseQT")){TextArea.text="RT @"+b.user.screen_name+": "+b.text;TextArea.show();TextArea.setFocus()}else System.showMessage("\u9078\u629e\u9805\u76ee\u3092\u30ea\u30c4\u30a4\u30fc\u30c8\u3057\u307e\u3059\u3002\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f","\u78ba\u8a8d",
4)===6&&k(a)});System.addKeyBindingHandler(87,0,function(a){var b=TwitterService.status.get(a);if(System.settings.getValue("Misc","UseQT"))System.showMessage("\u9078\u629e\u9805\u76ee\u3092\u30ea\u30c4\u30a4\u30fc\u30c8\u3057\u307e\u3059\u3002\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f","\u78ba\u8a8d",4)===6&&k(a);else{TextArea.text="RT @"+b.user.screen_name+": "+b.text;TextArea.show();TextArea.setFocus()}});d(AzureaUtil.retweet,{addEventListener:function(a,b){var e=w[a],f=-1;if(e){for(;e[++f];)e[f]===
b&&e.splice(f,1);e.push(b)}},removeEventListener:function(a,b){for(var e=w[a],f=-1;e[++f];)if(e[f]===b){e.splice(f,1);break}},create:k});var s={PreProcessTimelineStatuses:[],PreProcessTimelineStatus:[],PreFilterProcessTimelineStatus:[],PostFilterProcessTimelineStatus:[],PostProcessTimelineStatus:[],PostProcessTimelineStatuses:[],PreSendUpdateStatus:[],PostSendUpdateStatus:[],ReceiveFavorite:[]};d(AzureaUtil.event,{PreProcessTimelineStatuses:s.PreProcessTimelineStatuses,PreProcessTimelineStatus:s.PreProcessTimelineStatus,
PreFilterProcessTimelineStatus:s.PreFilterProcessTimelineStatus,PostFilterProcessTimelineStatus:s.PostFilterProcessTimelineStatus,PostProcessTimelineStatus:s.PostProcessTimelineStatus,PostProcessTimelineStatuses:s.PostProcessTimelineStatuses,PreSendUpdateStatus:s.PreSendUpdateStatus,PostSendUpdateStatus:s.PostSendUpdateStatus,ReceiveFavorite:s.ReceiveFavorite,addEventListener:l,removeEventListener:function(a,b){for(var e=s[a],f=-1;e[++f];)if(e[f]===b){e.splice(f,1);break}}});var o={},A={};timeevent_list=
function(){for(var a={},b,e=-1;b=c("TimeEvent"+ ++e);)a[b.substring(0,b.indexOf(":"))]=[b.substring(b.indexOf(":")+1,b.indexOf("|"))-0,eval("(function(){return "+b.substring(b.indexOf("|")+1)+"})()"),e];return a}();l("PreProcessTimelineStatus",i);l("PostSendUpdateStatus",i);l("ReceiveFavorite",i);d(AzureaUtil.time,{setTimeout:function(a,b){var e=Math.floor(Math.random()*(new Date).getTime()).toString(36);o[e]=[(new Date).getTime()+b,a];return e},clearTimeout:function(a){delete o[a]},setInterval:function(a,
b){var e=Math.floor(Math.random()*(new Date).getTime()).toString(36);timeinterval_list[e]=[(new Date).getTime()+b,a,b];return e},clearInterval:function(a){delete timeinterval_list[a]},setTimeevent:function(a,b){for(var e=Math.floor(Math.random()*(new Date).getTime()).toString(36),f=-1;c("TimeEvent"+ ++f););g("TimeEvent"+f,e+":"+b+"|"+a);timeevent_list[e]=[b,eval("(function(){return "+a+"})()"),f];return e},clearTimeevent:function(a){j("TimeEvent"+timeevent_list[a][2]);delete timeevent_list[a]}});
d(AzureaUtil.template,{expand:function(a,b){function e(p){var u,z,t;if(typeof p==="string"||p instanceof String)u='"'+p.replace('"','\\"')+'"';else if(typeof p==="number"||p instanceof Number)u=p.toString(10);else if(p===true||p===false)u=p;else if(p===null)u="null";else if(typeof p==="undefined")u="void(0)";else if(p instanceof Array){u="[";z=0;for(t=p.length;z<t;++z)u+=e(p[z])+",";u=u.replace(/,$/,"")+"]"}else{u="{";for(z in p)if(p.hasOwnProperty(z))u+='"'+z+'":'+e(p[z])+",";u=u.replace(/,$/,"")+
"}"}return u}var f,y=function(){var p,u="";for(p in b)if(b.hasOwnProperty(p))u+="var "+p+"="+e(b[p])+";";return u}(),m=a.replace(/#{([^}]+?)}/g,function(p,u){return eval("(function(){"+y+"return ("+u+")})()")});m=m.split("#{}");if(m.length===1){f=0;m=m[0]}else{f=m[0].length;m=m.join("")}return{text:m,cursor:f}}});d(AzureaUtil.yank,{get:function(a){if(a){a=a.charAt(0);if(/[0-9A-Za-z]/.test(a))a=""}else a="";return c("Yank"+a)},set:function(a,b){if(a){a=a.charAt(0);if(/[0-9A-Za-z]/.test(a))a=""}else a=
"";g("Yank"+a,b);return b}});AzureaUtil.notify=function(a,b){try{System.isActive?System.showNotice(a):System.showMessage(b,a,1048576)}catch(e){System.isActive?System.showNotice(a):System.showMessage(b,a,1048576)}}})();function PreProcessTimelineStatus(d){for(var g=AzureaUtil.event.PreProcessTimelineStatus,c=-1;g[++c];)g[c](d)}function PreFilterProcessTimelineStatus(d){for(var g=AzureaUtil.event.PreFilterProcessTimelineStatus,c=-1,j,h=false;g[++c];){j=g[c](d);h=h||j}return h}
function PreSendUpdateStatus(d){for(var g=AzureaUtil.event.PreSendUpdateStatus,c=-1,j,h=false;g[++c];){j=g[c](d);h=h||j}return h}function PostSendUpdateStatus(){for(var d=AzureaUtil.event.PostSendUpdateStatus,g=-1;d[++g];)d[g]()}function ReceiveFavorite(d,g,c){for(var j=AzureaUtil.event.ReceiveFavorite,h=-1;j[++h];)j[h](d,g,c)}AzureaVim={};
(function(){function d(h){var n=System.inputBox("command","",true),k=System.views.currentView;j=k.getItem(k.selectedItemId);AzureaUtil.yank.set(null,n);(new g({text:":"+n,in_reply_to_status_id:h||k.selectedStatusId})).run()}function g(h){var n=TwitterService.status,k=h.in_reply_to_status_id,l=n.get(k);this.item=j;h=this.command_text=h.text.slice(1);var i=[],q,v=/[^\s"]+|\s+|"[^\\"]*(?:\\.[^\\"]*)*"/g;for(h=h.replace(/^\s+|\s+$/g,"");q=v.exec(h);)/^\s/.test(q[0])||i.push(q[0].replace(/^"|"$/g,""));
this.command=i;this.status_id=k;this.user=l.user;this.screen_name=l.user.screen_name;this.status=l;this.status_text=l.text;this.status_urls=[];this.status_hashes=[];this.status_users=[];n.getUrls(k,this.status_urls);n.getHashes(k,this.status_hashes);n.getUsers(k,this.status_users)}var c={},j;System.addKeyBindingHandler(186,0,function(h){var n=System.views.currentView;j=n.getItem(n.selectedItemId);AzureaUtil.yank.set(null,TextArea.text);TextArea.text=":";TextArea.in_reply_to_status_id=h;TextArea.show();
TextArea.setFocus();TextArea.cursor=1});System.addKeyBindingHandler(186,2,d);System.addContextMenuHandler(":vim",0,d);AzureaUtil.event.addEventListener("PreSendUpdateStatus",function(h){var n,k=false;try{if(h.text===":"){k=true;AzureaUtil.time.setTimeout(function(){TextArea.text=AzureaUtil.yank.get(null);TextArea.show()},0)}else if(/^(?::|\uff1a)/.test(h.text)){k=true;AzureaUtil.yank.set(null,h.text);n=new g(h);TextArea.text="";TextArea.in_reply_to_status_id=0;n.run()}else AzureaUtil.yank.set(null,
h.text)}catch(l){System.alert(l.name+":\n"+l.message);k=true}return k});AzureaVim=g;AzureaVim.commands_list=c;AzureaVim.prototype={run:function(){var h=this.command,n=c[this.command[0]];if(n){if(n.indexOf(" ")!==-1){h.shift();h=this.command=n.split(" ").concat(h);n=h[0]}this[n]()}else System.showNotice(":"+h[0]+" command is undefined.")}}})();AzureaUtil.mixin(AzureaVim.commands_list,{unshorten:"unshorten","\u3046\u3093\u3057\u3087\uff52\u3066\uff4e":"unshorten"});
(function(){function d(i){h=i.body.split(", ");h.push("htn.to")}function g(i){for(var q=h,v=-1,w=false;q[++v];)if(i.indexOf(q[v])!==-1){w=true;break}return w}function c(i,q){function v(f){s=(f=f.header.match(/Location: ([^\n]+)\n/))?f[1]:i;f=f?f[1]:i;return s[i]=f}function w(f){f=/^error/.test(f.body)?i:f.body;return s[i]=f}var s=n,o=i;if(s[i])o=s[i];else if(i.indexOf("htn.to")!==-1)if(q)try{Http.sendRequestAsync(i,false,v)}catch(A){}else try{o=callback_htly(Http.sendRequest(i,false))}catch(a){}else if(g(i))if(q)try{Http.sendRequestAsync("http://untiny.me/api/1.0/extract/?url="+
i+"&format=text",false,w)}catch(b){}else try{o=w(Http.sendRequest("http://untiny.me/api/1.0/extract/?url="+i+"&format=text",false))}catch(e){}return o}function j(i,q){function v(b){b=b.body.match(/<body>([\s\S]*?)<\/body>/m)[1];var e;if(e=b.match(/<!\[CDATA\[([\s\S]*?)\]\]>/m))b=e[1].replace(/<\/(?:p|div|blockquote)>/g,"\n").replace(/<[\s\S]+?>/mg,"");b+="\n"+i;return w[s]=b}var w=k,s=i.match(/^https?:\/\/post\.ly\/(.+)$/)[1],o=i;if(w[s])o=w[s];else if(q)try{Http.sendRequestAsync("http://posterous.com/api/getpost?id="+
s,false,v)}catch(A){}else try{o=v(Http.sendRequest("http://posterous.com/api/getpost?id="+s,false))}catch(a){}return o}var h,n={"http://c4se.tk/":"http://c4se.sakura.ne.jp/"},k={};try{Http.sendRequestAsync("http://untiny.me/api/1.0/services/?format=text",true,d)}catch(l){}AzureaUtil.event.addEventListener("PreProcessTimelineStatus",function(i){i.text=i.text.replace(/https?:\/\/[0-9A-Za-z._\-^~\/&%?]+/g,function(q){return q.indexOf("post.ly")!==-1?j(q,true):c(q,true)})});AzureaVim.prototype.unshorten=
function(){var i=this.status_urls[this.command[1]||0];this.item.text=i.indexOf("post.ly")!==-1?this.status_text.replace(i,j(i,false)):this.status_text.replace(i,c(i,false))};AzureaVim.prototype.unshorten.unshorten=c})();AzureaUtil.mixin(AzureaVim.commands_list,{open:"open",o:"open","\u304a":"open",url:"open url","\u3046\uff52\uff4c":"open url"});
(function(){function d(){var c=d.c1[this.command[1]]?d.addresses[d.c1[this.command[1]]].call(this):this.status_urls[0]?this.status_urls[0]:"https://twitter.com/"+this.screen_name+"/status/"+this.status_id,j;c=g(c,true);(j=System.getPreviewUrl(c))?System.showPreview(c,j):System.openUrl(c)}var g=AzureaVim.prototype.unshorten?AzureaVim.prototype.unshorten.unshorten:function(c){return c};d.c1={status:"status",favstar:"favstar",fav:"favstar",f:"favstar",favotter:"favotter",favlook:"favlook",twistar:"twistar",
favolog:"favolog",twilog:"twilog",user:"user",u:"user",url:"url"};d.addresses={status:function(){return"https://twitter.com/"+this.screen_name+"/status/"+this.status_id},favstar:function(){return"http://favstar.fm/t/"+this.status_id},favotter:function(){return"http://favotter.net/status.php?id="+this.status_id},favlook:function(){return"http://favlook.osa-p.net/status.html?status_id="+this.status_id},twistar:function(){return"http://twistar.cc/"+this.screen_name+"/status/"+this.status_id},twilog:function(){return"http://twilog.org/"+
(this.command[2]||this.screen_name)},user:function(){return"http://twitter.com/"+(this.command[2]||this.screen_name)},url:function(){return this.status_urls[this.command[2]||0]}};AzureaVim.prototype.open=d;System.addKeyBindingHandler(190,0,function(c){TwitterService.status.update(":o",c)})})();AzureaUtil.mixin(AzureaVim.commands_list,{reply:"reply",r:"reply","\uff52":"reply","@":"reply","\uff20":"reply",quotetweet:"reply quote",qt:"reply quote","\uff51\uff54":"reply quote",mrt:"reply mrt","\uff4d\uff52\uff54":"reply mrt"});
(function(){function d(){function g(){TextArea.text=h.text;TextArea.in_reply_to_status_id=c===true?j:0;TextArea.show();TextArea.setFocus();TextArea.cursor=h.cursor}var c,j=this.status_id,h,n;if(this.command[1]==="template"){c=this.command[3]==="true";h=AzureaUtil.template.expand(this.command[2],this);Http.sendRequestAsync("http://google.com/",false,g)}else{n=d.templates[d.c1[this.command[1]]]||["@#{screen_name} #{}#{status_hashes.length ? ' ' + status_hashes.join(' ') : ''}",true];if(typeof n==="function")n=
n.call(this);this.command=["reply","template",n[0],n[1]?"true":"false"];d.call(this)}}d.c1={template:"template",all:"all",quote:"quote",qt:"quote",mrt:"mrt",masirosiki:"mrt"};d.templates={all:["@#{screen_name + (status_users.length ? ' @' +status_users.join(' @') : '')} #{}",true],quote:["@#{screen_name} #{} RT: #{status_text}",true],mrt:function(){return this.command[2]==="f"||this.command[2]==="fav"||this.command[2]==="favstar"?["#{} MRT: #{'http://favstar.fm/t/' + status_id}",false]:["#{} MRT: #{'http://twitter.com/' + screen_name + '/status/' + status_id}",
false]}};AzureaVim.prototype.reply=d;System.addKeyBindingHandler(82,0,function(g){var c=TwitterService.status.get(g).user.screen_name,j=[];TwitterService.status.getHashes(g,j);TextArea.text="@"+c+" "+(j.length?" "+j.join(" "):"");TextArea.in_reply_to_status_id=g;TextArea.show();TextArea.setFocus();TextArea.cursor=c.length+2})})();AzureaUtil.mixin(AzureaVim.commands_list,{retweet:"retweet",rt:"retweet","\uff52\uff54":"retweet"});AzureaVim.prototype.retweet=function(){AzureaUtil.retweet.create(this.status_id)};
AzureaUtil.mixin(AzureaVim.commands_list,{settings:"settings",setting:"settings",set:"settings","\u305b\uff54":"settings",get:"settings","\u3052\uff54":"settings"});
AzureaVim.prototype.settings=function(){var d;d=this.command.slice(1).join("");d=d.split("::");d=[d[0]].concat(d[1].split("="));if(/^(?:get|\u3052\uff54)/.test(this.command[0]))d.length=2;if(d[2]){System.settings.setValue(d[0],d[1],d[2]);System.showNotice("Setting done: "+d[0]+"::"+d[1]+"="+d[2])}else System.showNotice("Getting done: "+d[0]+"::"+d[1]+"="+System.settings.getValue(d[0],d[1]))};AzureaUtil.mixin(AzureaVim.commands_list,{shindan:"shindanmaker","\u3057\u3093\u3060\uff4e":"shindanmaker"});
AzureaVim.prototype.shindanmaker=function(){for(var d,g=-1,c=this.unshorten?this.unshorten.unshorten:function(j){return j};d=c(this.status_urls[++g],true);)if(d.match("^http://shindanmaker.com/[0-9]+"))break;if(d)Http.postRequestAsync(d,"u="+encodeURI(this.command[1]||TwitterService.currentUser.screen_name),false,function(j){j.body.match("<textarea.*?>(.*?)</textarea>");TextArea.text=RegExp.$1;TextArea.in_reply_to_status_id=0;TextArea.show();TextArea.setFocus()})};
AzureaUtil.mixin(AzureaVim.commands_list,{translate:"translate",ja:"translate ja","\u3058\u3083":"translate ja"});
AzureaVim.prototype.translate=function(){var d=System.views.currentView,g=d.getItem(d.selectedItemId);this.command[1]||(this.command[1]="ja");Http.sendRequestAsync("https://www.googleapis.com/language/translate/v2?key=AIzaSyCva1yUIFIBRqXOZDJ0nrbGbm0bz3FIksc&q="+encodeURI(this.status_text)+"&target="+this.command[1],false,function(c){if(c.statusCode!==200)throw Error("Google Translate API Error. statusCode is "+c.statusCode+".");g.text=c.body.match(/"translatedText"\s*:\s*"(.*)"/)[1]})};
AzureaUtil.mixin(AzureaVim.commands_list,{view:"view",v:"view",home:"view home","\u307b\u3081":"view home",user:"view user","\u3046\u305b\uff52":"view user"});
AzureaVim.prototype.view=function(){switch(this.view.c1[this.command[1]]){case "home":System.views.openView(0);break;case "mention":System.views.openView(1);break;case "message":System.views.openView(2);break;case "user":System.views.openView(5,this.command[2]||this.screen_name);break;case "search":System.views.openView(4,this.command[2]);break;case "favorite":System.views.openView(3);break;case "match":System.views.openView(6,this.command[2]);break;case "following":System.views.openView(8);break;
case "followers":System.views.openView(9)}};AzureaVim.prototype.view.c1={home:"home",timeline:"home",h:"home",mention:"mention",reply:"mention",r:"mention",m:"mention","@":"mention",message:"message",dm:"message",d:"message",user:"user",u:"user",search:"search",favorite:"favorite",fav:"favorite",f:"favorite",match:"match",following:"following",follow:"following",followers:"followers",follower:"followers",followed:"followers"};
AzureaUtil.mixin(AzureaVim.commands_list,{earthquake:"earthquake",jisin:"earthquake","\u3048\u3042\uff52\uff54\uff48\u304f\u3042\u3051":"earthquake","\u3058\u3057\uff4e":"earthquake"});
(function(){function d(c){var j=AzureaUtil.db.get("EarthquakeMessage");if(c!=null)j=AzureaUtil.template.expand(j,c).text;return j}function g(c){c=c||AzureaUtil.db.get("EarthquakeMessage");AzureaUtil.db.set("EarthquakeMessage",c);return c}AzureaUtil.db.get("EarthquakeMessage")||AzureaUtil.db.set("EarthquakeMessage","\u5730\u9707\u306a\u3046 #{Date()}");AzureaVim.prototype.earthquake=function(){var c;switch(this.command[1]){case "set":if(this.command[2])c=g(this.command[2]);else{c=System.inputBox("\u5730\u9707\u306a\u3046\u6295\u7a3f\u6587",
d(),false);g(c);c=c}c=c;break;default:TwitterService.status.update(d(this),0)}return c};System.addKeyBindingHandler(40,2,function(){TwitterService.status.update(":earthquake",0)})})();AzureaUtil.mixin(AzureaVim.commands_list,{delay:"delay","\u3067\u3041\uff59":"delay"});
(function(){function d(g,c,j){Http.postRequestAsync("http://twitdelay.appspot.com/api/post","user_id="+TwitterService.currentUser.id+"&api_key="+AzureaUtil.db.get("DelayTwitDelayApiKey")+"&status="+g+"&at="+c,false,j)}AzureaUtil.db.get("DelayUseTwitDelay")&&AzureaUtil.db.set("DelayUseTwitDelay","0");AzureaVim.prototype.delay=function(){var g,c;if(g=this.command[1].match(/^(?:(?:(\d{4})-)?(\d{1,2})-(\d{1,2}) )?(\d{1,2}):(\d{1,2})(?::(\d{1,2}))?$/)){c=new Date;g[1]&&c.setFullYear(g[1]);g[2]&&c.setMonth(g[2]-
1);g[3]&&c.setDate(g[3]);c.setHours(g[4]);c.setMinutes(g[5]);c.setSeconds(0);g[6]&&c.setSeconds(g[6]);this.command[1]=c.getTime();g=2}else{this.command[1]=(new Date).getTime()+(this.command[1]-0);g=1}this.command[2]=this.command.slice(2).join(" ");if(AzureaUtil.db.get("DelayUseTwitDelay")){c=new Date(this.command[1]);d(this.command[2],c.getUTCDate()+" "+c.getUTCMonth()+" "+c.getUTCFullYear()+" "+c.getUTCHours()+":"+c.getUTCMinutes()+":"+c.getUTCSeconds()+" +0000",function(){})}else g===1?AzureaUtil.time.setTimeout(function(j){return function(){TwitterService.status.update(j.command[2],
j.status_id)}}(this),this.command[1]-(new Date).getTime()):AzureaUtil.time.setTimeevent('function() {TwitterService.status.update("'+this.command[2]+'", "'+this.status_id+'");}',this.command[1])}})();AzureaUtil.mixin(AzureaVim.codelist,{});System.addKeyBindingHandler(67,2,function(d){d=TwitterService.status.get(d).text;System.clipboard=d;AzureaUtil.yank.set(null,d)});AzureaUtil.mixin(AzureaVim.commands_list,{notify:"notify"});
(function(){function d(k,l){l=l||"";if(k){h=RegExp(k,l);AzureaUtil.db.set("NotifyPattern",k);AzureaUtil.db.set("NotifyPatternOption",l)}else h=null;return h}function g(){function k(q){var v,w=q.match(/^\/(.*)\/([a-zA-Z]*)$/);if(w){q=w[1];v=w[2].toLowerCase()}return[q,v]}var l,i;switch(g.c1[this.command[1]]){case "pattern":if(l=this.command.slice(2).join(" "))l=k(l);else{l=AzureaUtil.db.get("NotifyPattern");i=AzureaUtil.db.get("NotifyPatternOption");l=k(System.inputBox("tweet\u306b\u30de\u30c3\u30c1\u3055\u305b\u308b\u6b63\u898f\u8868\u73fe",
i?"/"+l+"/"+i:l,false))}i=l[1];l=l[0];d(l,i);break;case "when":l=g.c2[this.command[2]];if(!l)throw Error("plugins/notify: No such option as NotifyWhen "+this.command[2]);n[l]=(this.command[3]||System.inputBox("NotifyWhen"+l,n[l],true))==="0"?"0":"1";AzureaUtil.db.set("NotifyWhen"+l,n[l]);break;case "growl":AzureaUtil.db.set("NotifyUseGrowl",(this.command[2]||System.inputBox("NotifyUseGrowl",AzureaUtil.db.get("NotifyUseGrowl"),true))==="0"?"0":"1")}}var c=AzureaUtil.db.get("NotifyPattern"),j=AzureaUtil.db.get("NotifyPatternOption"),
h=null,n={Faved:AzureaUtil.db.get("NotifyWhenFaved"),Mention:AzureaUtil.db.get("NotifyWhenMention"),Matched:AzureaUtil.db.get("NotifyWhenMatched")};if(c)h=RegExp(c,j);g.c1={pattern:"pattern",when:"when",growl:"growl",gntp:"growl"};g.c2={faved:"Faved",fav:"Faved",f:"Faved",mention:"Mention",reply:"Mention",r:"Mention","@":"Mention",matched:"Matched",match:"Matched",m:"Matched"};AzureaVim.prototype.notify=g;AzureaUtil.event.addEventListener("ReceiveFavorite",function(k,l,i){n.Faved&&AzureaUtil.notify("Favs@"+
k.screen_name+": "+i.text,"Favs - AzureaVim",k.profile_image_url,false)});AzureaUtil.event.addEventListener("PreFilterProcessTimelineStatus",function(k){var l=n,i=k.text;k=k.user;l.Mention&&i.indexOf(TwitterService.currentUser.screen_name)!==-1&&AzureaUtil.notify("Mention@"+k.screen_name+": "+i,"Mention - AzureaVim",k.profile_image_url,false);l.Matched&&h&&h.test(i)&&AzureaUtil.notify("Matches@"+k.screen_name+": "+i,"Matched - AzureaVim",k.profile_image_url,false)})})();
AzureaUtil.mixin(AzureaVim.commands_list,{tumblr:"tumblr","\u3064\uff4d\uff42\uff4c\uff52":"tumblr"});
(function(){function d(o,A){Http.postRequestAsync("https://www.tumblr.com/api/authenticate","email="+o+"&password="+A,false,function(a){i=200<=a.statusCode||a.statusCode<300?true:false})}function g(o,A,a,b,e,f){function y(m){var p,u=[];for(p in m)m.hasOwnProperty(p)&&u.push(p+"="+encodeURI(m[p]));return u.join("&")}Http.postRequestAsync("https://www.tumblr.com/api/write","email="+o+"&password="+A+"&type="+a+"&"+y(b)+(e?"&"+y(e):""),false,f)}function c(o){if(o.user.protected_)throw Error("plugins/tumblr: "+
o.user.screen_name+" is protected_.");else g(h,n,"quote",{quote:o.text,source:'<a href="http://twitter.com/'+o.user.screen_name+"/"+o.id+'">Twitter:'+o.user.screen_name+"</a>"},{generator:"AzureaVim",tags:l},function(A){if(A.statusCode<200&&300<=A.statusCode)throw Error("plugins/tumblr: Cannot create post. (statusCode="+A.statusCode+")");})}function j(){var o;switch(j.c1[this.command[1]]){case "when":o=j.c2[this.command[2]];if(!o)throw Error("plugins/tumblr: No such option as TumblrWhen "+this.command[2]);
k[o]=(this.command[3]||System.inputBox("TumblrWhen"+o,k[o],true))==="0"?"0":"1";AzureaUtil.db.set("TumblrWhen"+o,k[o]);k.Favorite!=="0"?q("postCreateFavorite",c):v("postCreateFavorite",c);k.Retweet!=="0"?w("postCreateRetweet",c):s("postCreateRetweet",c);break;case "email":h=this.command[2]||System.inputBox("TumblrEmail",h,true);AzureaUtil.db.set("TumblrEmail",h);d(h,n);break;case "password":n=this.command[2]||System.inputBox("TumblrPassword",n,true);AzureaUtil.db.set("TumblrPassword",n);d(h,n);break;
case "tags":l=this.command[2]||System.inputBox("TumblrTags",l,false);AzureaUtil.db.set("TumblrTags",l);break;default:if(!i)throw Error("plugins/tumblr: Authenticate your email & password.");c(this.status)}}var h=AzureaUtil.db.get("TumblrEmail"),n=AzureaUtil.db.get("TumblrPassword"),k={Favorite:AzureaUtil.db.get("TumblrWhenFavorite"),Retweet:AzureaUtil.db.get("TumblrWhenRetweet")},l=AzureaUtil.db.get("TumblrTags"),i=false,q=AzureaUtil.favorite.addEventListener,v=AzureaUtil.favorite.removeEventListener,
w=AzureaUtil.retweet.addEventListener,s=AzureaUtil.retweet.removeEventListener;d(h,n);k.Favorite&&q("postCreateFavorite",c);k.Retweet&&w("postRetweetFavorite",c);j.c1={when:"when",email:"email",password:"password",tags:"tags",tag:"tags"};j.c2={favorite:"Favorite",fav:"Favorite",f:"Favorite",retweet:"Retweet",rt:"Retweet"};AzureaVim.prototype.tumblr=j})();
